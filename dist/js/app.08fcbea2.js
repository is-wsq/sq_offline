(function(){"use strict";var e={4661:function(e,t,s){var i=s(5471),a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("dashboard")],1)},o=[],r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("el-container",[t("el-aside",{staticClass:"aside"},[t("span",{staticStyle:{"font-size":"20px","font-weight":"bold",color:"#5478FE"}},[e._v("奇点")]),t("div",{staticClass:"aside-menu"},e._l(e.menus,(function(s,i){return t("div",{key:i,staticClass:"menu-group",style:{"background-color":e.active===i?"#e3eaff":"#ffffff"}},[t("div",{staticClass:"menu-item",class:{active:e.active===i,inactive:e.active!==i},attrs:{title:"克隆形象"},on:{click:function(t){return e.changeActive(i,s.path)}}},[t("i",{class:s.class,style:{color:e.active===i?"#FFFFFF":"#8F92A1","font-size":"20px"}})]),t("div",{staticStyle:{"font-size":"12px",color:"#6D7177","margin-top":"5px"}},[e._v(e._s(s.name))])])})),0)]),t("el-main",{staticClass:"main"},[t("router-view")],1)],1)],1)},n=[],l=(s(4114),{components:{},data(){return{active:0,menus:[{name:"AI大模型",path:"/",class:"el-icon-robot"},{name:"克隆形象",path:"/figures",class:"el-icon-figure"},{name:"克隆声音",path:"/voice",class:"el-icon-voice"},{name:"生成视频",path:"/video",class:"el-icon-video"},{name:"关于我们",path:"/system",class:"el-icon-s-tools"}]}},mounted(){switch(this.$route.path){case"/":this.active=0;break;case"/figures":this.active=1;break;case"/voice":this.active=2;break;case"/video":this.active=3;break;case"/system":this.active=4;break;default:this.active=0;break}},methods:{changeActive(e,t){this.active!==e&&(this.active=e,this.$router.push({path:t}))}}}),c=l,d=s(1656),u=(0,d.A)(c,r,n,!1,null,null,null),h=u.exports,p={name:"App",components:{dashboard:h}},m=p,g=(0,d.A)(m,a,o,!1,null,null,null),v=g.exports,f=s(173),y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login"},[t("div",{staticClass:"container"},[t("span",{staticStyle:{"font-size":"30px","font-weight":"bold",color:"#5478FE"}},[e._v("奇点")]),t("el-form",{ref:"form",staticClass:"login-form",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[t("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",[t("el-button",{staticClass:"btn margin-bottom-20",attrs:{type:"primary"},on:{click:e.handleLogin}},[e._v("登录")])],1),t("el-form-item",[t("el-button",{staticClass:"btn",on:{click:e.createAccount}},[e._v("创建账户")])],1)],1)],1)])},k=[],b=s(4335);const w="http://127.0.0.1:6006",S=(e=6e4)=>b.A.create({baseURL:w,timeout:e,headers:{"Content-Type":"application/json"}});let _=S();_.interceptors.request.use((e=>e),(e=>Promise.reject(e))),_.interceptors.response.use((e=>({status:e.status,data:e.data})),(e=>(console.log(e),Promise.reject(e))));const x=(e,t={},s=6e4)=>(_=S(s),_.get(e,{params:t})),C=(e,t={},s=6e4)=>(_=S(s),_.post(e,t)),$=(e,t={},s=6e4)=>(_=S(s),_.delete(e,{params:t}));var A={data(){return{form:{phone:"",password:""},rules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"请输入正确的手机号",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符之间",trigger:"blur"}]}}},methods:{handleLogin(){C("/user/login",this.form).then((e=>{"success"===e.data.status?this.$message.success("登录成功"):this.$message.error(e.data.message)}))},createAccount(){this.$router.push({path:"/register"})}}},T=A,P=(0,d.A)(T,y,k,!1,null,"04ec44a9",null),F=P.exports,I=function(){var e=this,t=e._self._c;return t("div",{staticClass:"register"},[t("div",{staticClass:"register-container"},[t("span",{staticStyle:{"font-size":"30px","font-weight":"bold",color:"#5478FE"}},[e._v("奇点")]),t("el-form",{ref:"form",staticClass:"login-form",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[t("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"rePassword"}},[t("el-input",{attrs:{type:"password"},model:{value:e.form.rePassword,callback:function(t){e.$set(e.form,"rePassword",t)},expression:"form.rePassword"}})],1),t("el-form-item",[t("el-button",{staticClass:"btn",on:{click:e.handleLogin}},[e._v("登录")])],1),t("el-form-item",[t("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:e.createAccount}},[e._v("创建账户")])],1)],1)],1)])},q=[],O={name:"Register",data(){return{form:{phone:"",password:"",rePassword:""},rules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符之间",trigger:"blur"}],rePassword:[{required:!0,message:"请确认密码",trigger:["blur","change"]},{validator:this.checkConfirmPassword,trigger:["blur","change"]}]}}},methods:{handleLogin(){this.$router.push({path:"/"})},checkConfirmPassword(e,t,s){""===t?s(new Error("请确认新密码")):t!==this.form.rePassword?s(new Error("确认密码与新密码不一致")):s()},createAccount(){C("/user/register",this.form).then((e=>{"success"===e.data.status?(this.$message.success("注册成功，请登录"),this.$router.push({path:"/"})):this.$message.error(e.data.message),this.form={}}))}}},E=O,N=(0,d.A)(E,I,q,!1,null,"15625bf8",null),M=N.exports,U=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ai"},[t("div",{staticClass:"ai-content"},[t("div",{staticStyle:{display:"flex",height:"40px","align-items":"center"}},[t("el-switch",{attrs:{width:50,"active-color":"#6286ED"},on:{change:e.switchChange},model:{value:e.modelOpen,callback:function(t){e.modelOpen=t},expression:"modelOpen"}}),t("span",{staticStyle:{"margin-left":"20px","font-size":"16px",color:"#6d7177"}},[e._v("模型开关")])],1),t("el-button",{staticClass:"enter-service",on:{click:e.enterService}},[e._v("进入服务")])],1),t("div",{staticStyle:{"margin-top":"74px",color:"#6d7177","font-size":"16px","line-height":"27px"}},[e._v(" 请开启模型后再点击 “进入服务” 使用AI大模型，使用完毕后请关闭模型开关释放资源。 ")]),t("div",{staticStyle:{color:"#6d7177","font-size":"16px","line-height":"27px"}},[e._v(" 注意，模型服务与数字人形象无法同时使用，关闭模型开关即可正常使用数字人服务。 ")])])},V=[],L={data(){return{modelOpen:!1}},async mounted(){this.modelOpen=await this.queryServiceStatus()},methods:{enterService(){this.modelOpen?window.open("http://127.0.0.1:8080"):this.$message.error("请先开启模型服务")},async queryServiceStatus(){return b.A.get("http://127.0.0.1:11434/api/ps").then((e=>e.data.models.length>0)).catch((e=>!1))},switchChange(e){e?this.startService():this.stopService()},startService(){let e={model:"hf-mirror.com/unsloth/QwQ-32B-GGUF:Q3_K_M",keep_alive:-1};C("stop_docker_service").then((t=>{"success"===t.data.status?b.A.post("http://127.0.0.1:11434/api/generate",e).then((e=>{e.data.done?this.$message.success("模型加载成功"):this.$message.error(e.data.message)})):(this.modelOpen=!1,this.$message.error("当前后台有任务在进行中，请稍后再试。"))})).catch((e=>{this.modelOpen=!1,this.$message.error("当前后台有任务在进行中，请稍后再试。")}))},stopService(){let e={model:"hf-mirror.com/unsloth/QwQ-32B-GGUF:Q3_K_M",keep_alive:0};b.A.post("http://127.0.0.1:11434/api/generate",e).then((e=>{e.data.done?this.$message.success("模型卸载成功"):this.$message.error(e.data.message)})).catch((e=>{this.$message.error("模型卸载失败，请稍后重试。")}))}}},j=L,z=(0,d.A)(j,U,V,!1,null,"defe8572",null),D=z.exports,K=function(){var e=this,t=e._self._c;return t("div",{staticClass:"figures"},[t("div",{staticClass:"figures-content"},[t("div",{staticClass:"figures-list"},e._l(e.figures,(function(s,i){return t("div",{key:i,on:{contextmenu:function(t){return t.stopPropagation(),e.handleContextMenu(s,t)}}},[t("el-image",{staticClass:"figures-img",attrs:{src:s.picture,fit:"cover"}}),t("div",{staticStyle:{width:"100%","text-align":"center"}},[e._v(e._s(s.name))])],1)})),0),t("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://127.0.0.1:6006/figure/clone","show-file-list":!1,accept:".mp4, .mov","on-success":e.uploadSuccess,"on-error":e.uploadError,"before-upload":e.beforeUpload}},[t("el-button",{staticClass:"figures-btn"},[e._v("添加形象")])],1)],1),e.rightMenuVisible?t("div",{style:e.menuStyle},[t("div",{staticClass:"right-item",on:{click:e.preview}},[t("i",{staticClass:"el-icon-view menu-icon"}),t("span",{staticStyle:{"margin-top":"2px"}},[e._v("预览")])]),t("div",{staticClass:"right-item",on:{click:e.rename}},[t("i",{staticClass:"el-icon-edit-outline menu-icon"}),t("span",{staticStyle:{"margin-top":"2px"}},[e._v("重命名")])]),t("div",{staticClass:"right-item",on:{click:e.deleteItem}},[t("i",{staticClass:"el-icon-delete-solid menu-icon"}),t("span",{staticStyle:{"margin-top":"2px"}},[e._v("删除")])])]):e._e()]),t("el-dialog",{attrs:{visible:e.dialogVisible,"before-close":e.beforeClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticStyle:{width:"100%","text-align":"center",position:"relative"}},[t("video",{ref:"video",staticStyle:{width:"300px","border-radius":"20px"},attrs:{src:e.src}}),t("div",{staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},[e.isPlaying?e._e():t("i",{staticClass:"el-icon-play control-icon",on:{click:e.controlVideo}})])])]),t("el-drawer",{attrs:{title:"重命名形象名称",visible:e.drawer,direction:"rtl"},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticStyle:{width:"100%","text-align":"center"}},[t("el-form",{ref:"form",staticStyle:{width:"70%",margin:"0 auto"}},[t("el-form-item",{attrs:{label:"新名称",prop:"newName"}},[t("el-input",{attrs:{placeholder:"请输入新名称"},model:{value:e.newName,callback:function(t){e.newName=t},expression:"newName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1)],1)],1)]),t("div",{staticClass:"figures-footer"},[e._v(" 请上传格式为mp4\\mov的视频进行形象克隆，建议视频时长为5分钟。请在无遮挡场景进行录制，确保面部清晰出镜，面部表情丰富，适当添加无指向性手部动作。 ")])],1)},R=[];s(8111),s(2489);const H={data(){return{menuStyle:{position:"fixed",top:"0",left:"0",border:"1px solid #eee","border-radius":"10px","background-color":"#fff","z-index":9999},rightMenuVisible:!1,selectedItem:{}}},methods:{handleContextMenu(e,t){t.preventDefault(),this.rightMenuVisible=!0,this.selectedItem=e,this.menuStyle.left=t.clientX+"px",this.menuStyle.top=t.clientY+"px",document.body.addEventListener("click",this.bodyClick)},bodyClick(){this.rightMenuVisible=!1,this.selectedItem={},document.body.removeEventListener("click",this.bodyClick)}}};var J=s(6278),Q={name:"figures",mixins:[H],data(){return{figures:[],dialogVisible:!1,drawer:!1,src:"",isPlaying:!1,figureId:null,newName:""}},computed:{...(0,J.L8)("task",["allTasks"]),voiceTasks(){return this.allTasks.filter((e=>"figures"===e.type))}},watch:{voiceTasks:{handler(){this.queryFigures()},deep:!0}},mounted(){this.queryFigures()},methods:{queryFigures(){x("/figure/query_success").then((e=>{"success"===e.data.status&&(this.figures=e.data.data)})).catch((e=>{this.$message.error("获取形象列表失败，请稍后重试！")}))},preview(){this.src=this.selectedItem.filepath,this.dialogVisible=!0},rename(){this.figureId=this.selectedItem.id,this.newName="",this.drawer=!0},onSave(){let e={figure_id:this.figureId,name:this.newName};C("/figure/update_name",e).then((e=>{"success"===e.data.status?(this.$message.success("重命名成功"),this.queryFigures()):this.$message.error(e.data.message),this.drawer=!1})).catch((e=>{this.$message.error("重命名失败，请稍后重试！")}))},deleteItem(){$("/figure/delete",{figure_id:this.selectedItem.id}).then((e=>{"success"===e.data.status?(this.$message.success("删除成功"),this.queryFigures()):this.$message.error(e.data.message)})).catch((e=>{this.$message.error("删除失败，请稍后重试！")}))},controlVideo(){const e=this.$refs.video;this.isPlaying?(e.pause(),this.isPlaying=!1):(e.play(),this.isPlaying=!0)},beforeClose(){this.isPlaying=!1;const e=this.$refs.video;e.pause(),this.dialogVisible=!1},beforeUpload(e){this.task={type:"figures",id:e.uid,name:e.name,status:"running"},this.$store.dispatch("task/addTask",this.task);let t=`已创建${e.name}形象克隆任务，形象克隆成功后会自动更新形象列表`;this.$alert(t,"任务创建提醒")},uploadError(e){this.$store.dispatch("task/removeTask",this.task.id),this.$notify({title:"克隆失败",message:`${e.name}形象克隆任务失败！`,duration:0,type:"error"})},uploadSuccess(e,t){"success"===e.status?(this.$store.dispatch("task/removeTask",this.task.id),this.$notify({title:"克隆成功",message:`${t.name}形象克隆任务已完成！`,duration:0,type:"success"}),this.queryFigures()):(this.$store.dispatch("task/removeTask",this.task.id),this.$notify({title:"克隆失败",message:`${t.name}形象克隆任务失败！`,duration:0,type:"error"}))}}},B=Q,G=(0,d.A)(B,K,R,!1,null,"21da5e8e",null),X=G.exports,Y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"voice"},[t("div",{staticClass:"voice-content"},[t("el-row",{staticStyle:{height:"100%",width:"100%",margin:"0 auto"},attrs:{gutter:40}},[t("el-col",{staticStyle:{height:"100%"},attrs:{span:12}},[t("div",{staticClass:"voice-type"},[e._v("系统音色")]),t("div",{staticClass:"voice-list"},e._l(e.systemSounds,(function(s,i){return t("div",{key:i,staticClass:"voice-item",on:{contextmenu:function(t){return t.stopPropagation(),e.handleContextMenu(s,t)}}},[t("div",{staticClass:"voice-icon",on:{click:function(t){return e.textAudio(s)}}},[t("el-image",{staticStyle:{width:"20px",height:"20px"},attrs:{src:s.isPlay?"/stop.png":"/play.png"}})],1),t("div",{staticClass:"voice-name",attrs:{title:s.name}},[e._v(e._s(s.name))])])})),0)]),t("el-col",{staticStyle:{height:"100%"},attrs:{span:12}},[t("div",{staticClass:"voice-type"},[e._v("克隆音色")]),t("div",{staticClass:"voice-list"},[t("div",{staticClass:"voice-item"},[t("el-upload",{attrs:{action:"http://127.0.0.1:6006/timbres/clone","show-file-list":!1,accept:".mp3, .wav","on-success":e.uploadSuccess,"on-error":e.uploadError,"before-upload":e.beforeUpload}},[t("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"80px"}},[t("div",{staticClass:"voice-icon",staticStyle:{"background-color":"pink !important"}},[t("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"15px",color:"red"}})]),t("div",{staticStyle:{width:"80px","margin-left":"10px","font-size":"14px",color:"#101010","text-align":"left"}},[e._v(" 上传音频 ")])])])],1),e._l(e.cloneSounds,(function(s,i){return t("div",{key:i,staticClass:"voice-item",on:{contextmenu:function(t){return t.stopPropagation(),e.handleContextMenu(s,t)}}},[t("div",{staticClass:"voice-icon",on:{click:function(t){return e.textAudio(s)}}},[t("el-image",{staticStyle:{width:"20px",height:"20px"},attrs:{src:s.isPlay?"/stop.png":"/play.png"}})],1),t("div",{staticClass:"voice-name",attrs:{title:s.name}},[e._v(e._s(s.name))])])}))],2)])],1),e.rightMenuVisible?t("div",{style:e.menuStyle},[t("div",{staticClass:"right-item",on:{click:e.listen}},[t("i",{staticClass:"el-icon-yangshengqi menu-icon"}),t("span",{staticStyle:{"margin-top":"2px"}},[e._v("试听")])]),"clone"===e.selectedItem.type?t("div",{staticClass:"right-item",on:{click:e.rename}},[t("i",{staticClass:"el-icon-edit-outline menu-icon"}),t("span",{staticStyle:{"margin-top":"2px"}},[e._v("重命名")])]):e._e(),"clone"===e.selectedItem.type?t("div",{staticClass:"right-item",on:{click:e.deleteItem}},[t("i",{staticClass:"el-icon-delete-solid menu-icon"}),t("span",{staticStyle:{"margin-top":"2px"}},[e._v("删除")])]):e._e()]):e._e()],1),t("el-drawer",{attrs:{title:"重命名音色名称",visible:e.drawer,direction:"rtl"},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticStyle:{width:"100%","text-align":"center"}},[t("el-form",{ref:"form",staticStyle:{width:"70%",margin:"0 auto"}},[t("el-form-item",{attrs:{label:"新名称",prop:"newName"}},[t("el-input",{attrs:{placeholder:"请输入新名称"},model:{value:e.newName,callback:function(t){e.newName=t},expression:"newName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1)],1)],1)]),t("div",{staticClass:"voice-footer"},[e._v(" 请上传格式为mp3\\wav的音频进行声音克隆，建议音频时长为3分钟。请在无遮挡场景进行录制，背景选取纯色无杂物最佳，面部表情丰富，适当添加无指向性手部动作。 ")])],1)},W=[],Z=(s(7588),{name:"Voice",mixins:[H],data(){return{figures:[],activeSound:{},sound:{},systemSounds:[],cloneSounds:[],audio:null,newName:"",drawer:!1,soundId:null,task:{}}},computed:{...(0,J.L8)("task",["allTasks"]),voiceTasks(){return this.allTasks.filter((e=>"voice"===e.type))}},watch:{voiceTasks:{handler(){this.querySounds()},deep:!0}},mounted(){this.querySounds()},methods:{querySounds(){x("/timbres/query_success").then((e=>{"success"===e.data.status?(this.systemSounds=[],this.cloneSounds=[],e.data.data.forEach((e=>{e.isPlay=!1,"system"===e.type?this.systemSounds.push(e):this.cloneSounds.push(e)}))):this.$message.error("获取声音列表失败。")})).catch((e=>{this.$message.error("获取声音列表失败，请稍后重试！")}))},textAudio(e){this.selectedItem=e,this.listen()},listen(){let e=this.selectedItem;e.isPlay?(this.audio.pause(),this.updateStatus(e,!1)):(this.audio=new Audio(e.filepath),this.audio.play(),this.updateStatus(e,!0),this.audio.onended=()=>{this.updateStatus(e,!1)})},updateStatus(e,t){if("system"===e.type){let s=this.systemSounds.findIndex((t=>t.id===e.id));this.systemSounds[s].isPlay=t}else{let s=this.cloneSounds.findIndex((t=>t.id===e.id));this.cloneSounds[s].isPlay=t}this.$forceUpdate()},rename(){this.soundId=this.selectedItem.id,this.newName="",this.drawer=!0},onSave(){let e={timbre_id:this.soundId,name:this.newName};C("/timbres/update_name",e).then((e=>{"success"===e.data.status?(this.$message.success("重命名成功。"),this.querySounds()):this.$message.error(e.data.message),this.drawer=!1})).catch((e=>{this.$message.error("重命名失败，请稍后重试！")}))},deleteItem(){$(`/timbres/${this.selectedItem.id}`).then((e=>{"success"===e.data.status?(this.$message.success("删除成功。"),this.querySounds()):this.$message.error(e.data.message)})).catch((e=>{this.$message.error("删除失败，请稍后重试！")}))},beforeUpload(e){this.task={type:"voice",id:e.uid,name:e.name,status:"running"},this.$store.dispatch("task/addTask",this.task);let t=`已创建${e.name}音色克隆任务，音色克隆成功后会自动更新音色列表`;this.$alert(t,"任务创建提醒")},uploadError(e){this.$store.dispatch("task/removeTask",this.task.id),this.$notify({title:"克隆失败",message:`${e.name}音色克隆任务失败！`,duration:0,type:"error"})},uploadSuccess(e,t){"success"===e.status?(this.$store.dispatch("task/removeTask",this.task.id),this.$notify({title:"克隆成功",message:`${t.name}音色克隆任务已完成！`,duration:0,type:"success"}),this.querySounds()):(this.$store.dispatch("task/removeTask",this.task.id),this.$notify({title:"克隆失败",message:`${t.name}音色克隆任务失败！`,duration:0,type:"error"}))}}}),ee=Z,te=(0,d.A)(ee,Y,W,!1,null,"fb4a12c8",null),se=te.exports,ie=function(){var e=this,t=e._self._c;return t("div",{staticClass:"video"},[t("div",{staticClass:"video-title"},[e._v("角色选择")]),t("div",{ref:"template",staticClass:"video-template",style:e.templateStyle},e._l(e.templates,(function(s){return t("div",{key:s.id,staticStyle:{"border-radius":"10px",width:"160px"},style:{"background-color":s.id===e.figure.id?"#e0e7fb":"#FFFFFF"},on:{click:function(t){e.figure=s}}},[t("div",[t("el-image",{staticClass:"template-img",attrs:{src:s.picture,fit:"cover"}})],1),t("div",{staticClass:"template-name"},[e._v(e._s(s.name))])])})),0),t("div",{staticClass:"more-btn"},[e.templateHigh?e._e():t("i",{staticClass:"el-icon-arrow-down more",on:{click:e.showMore}}),e.templateHigh?t("i",{staticClass:"el-icon-arrow-up more",on:{click:e.showMore}}):e._e()]),t("div",{staticClass:"video-title"},[e._v("声音选择")]),t("div",{staticClass:"voice-card"},[t("div",{staticClass:"play-btn",on:{click:e.listenAudio}},[t("el-image",{staticStyle:{width:"20px",height:"20px"},attrs:{src:e.isPlay?"/stop.png":"/play.png"}})],1),t("el-popover",{attrs:{placement:"right",trigger:"click"}},[t("div",{staticClass:"popover-content"},[t("el-row",e._l(e.voices,(function(s){return t("el-col",{key:s.id,attrs:{span:12}},[t("div",{staticClass:"voice-item",class:{active:s.id===e.sound.id},on:{click:function(t){e.sound=s}}},[t("div",{staticClass:"voice-icon",on:{click:function(t){return e.previewAudio(s)}}},[t("el-image",{staticStyle:{width:"20px",height:"20px"},attrs:{src:s.isPlay?"/stop.png":"/play.png"}})],1),t("div",{staticClass:"voice-name"},[e._v(e._s(s.name))])])])})),1)],1),t("div",{staticClass:"sound",attrs:{slot:"reference"},slot:"reference"},[t("div",{staticClass:"sound-name"},[e._v(e._s(e.sound.name))]),t("el-image",{staticStyle:{width:"20px",height:"20px",cursor:"pointer"},attrs:{src:"/more.png"}})],1)])],1),t("div",{staticClass:"video-title"},[e._v("口播文案")]),t("div",{staticClass:"text-card"},[t("el-input",{staticStyle:{height:"100%",width:"100%"},attrs:{type:"textarea"},on:{focus:function(t){e.isFocus=!0},blur:function(t){e.isFocus=!1}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),e.isFocus||""!==e.text?e._e():t("span",{staticClass:"text-tips"},[e._v("请输入视频口播文案")])],1),t("el-button",{staticClass:"generate-btn",on:{click:e.generateVideo}},[e._v("生成视频")])],1)},ae=[],oe=(s(4603),s(7566),s(8721),{name:"Video",data(){return{isPlay:!1,templateStyle:{height:"205px",overflow:"hidden"},templateHigh:!1,templates:[],figure:{},voices:[],sound:{},text:"",audio:null,testAudio:null,isFocus:!1}},computed:{...(0,J.L8)("task",["allTasks"]),voiceAndFigureTasks(){return this.allTasks.filter((e=>"figures"===e.type||"voice"===e.type))}},watch:{voiceAndFigureTasks:{handler(){this.querySounds(),this.queryFigures()},deep:!0}},mounted(){this.querySounds(),this.queryFigures()},methods:{queryFigures(){x("/figure/query_success").then((e=>{"success"===e.data.status&&(this.templates=e.data.data,this.templates.length>0&&(this.figure=this.templates[0]))})).catch((e=>{console.error("获取角色列表失败:",e)}))},querySounds(){x("/timbres/query_success").then((e=>{"success"===e.data.status?(this.voices=e.data.data,this.voices.forEach((e=>{e.isPlay=!1})),this.voices.length>0&&(this.sound=this.voices[0])):this.$message.error("获取声音列表失败。")})).catch((e=>{console.error("获取声音列表失败:",e)}))},showMore(){this.templateHigh?(this.$refs.template.scrollTop=0,this.templateStyle.height="205px",this.templateStyle.overflow="hidden",this.templateHigh=!1):(this.templateStyle.height="410px",this.templateStyle.overflow="auto",this.templateHigh=!0)},listenAudio(){let e=this;e.isPlay?(e.isPlay=!1,e.testAudio.pause()):(e.isPlay=!0,e.testAudio=new Audio(e.sound.filepath),e.testAudio.play(),e.testAudio.onended=()=>{e.isPlay=!1})},previewAudio(e){e.isPlay?(this.audio.pause(),this.updateStatus(e,!1)):(this.audio=new Audio(e.filepath),this.audio.play(),this.updateStatus(e,!0),this.audio.onended=()=>{this.updateStatus(e,!1)})},updateStatus(e,t){let s=this.voices.findIndex((t=>t.id===e.id));this.voices[s].isPlay=t,this.$forceUpdate()},generateUniqueId(){return Date.now()+Math.random().toString(36).substr(2,16)},generateVideo(){let e={type:"video",id:this.generateUniqueId(),status:"running"};this.$store.dispatch("task/addTask",e);let t="已创建视频生成任务，视频生成成功后会自动下载到本地";this.$alert(t,"任务创建提醒");let s={video_id:this.figure.video_id,voice_id:this.sound.voice_id,text:this.text};C("/figure/generate_video",s,18e6).then((t=>{if("success"===t.data.status){this.$store.dispatch("task/removeTask",e.id);let s=`${e.id}视频生成任务已完成！`;this.$notify({title:"生成成功",message:s,type:"success"}),this.downloadVideo(t.data.data.video_path)}else{this.$store.dispatch("task/removeTask",e.id);let t=`${e.id}视频生成任务失败！`;this.$notify({title:"生成失败",message:t,type:"error"})}})).catch((t=>{this.$store.dispatch("task/removeTask",e.id);let s=`${e.id}视频生成任务失败！`;this.$notify({title:"生成失败",message:s,type:"error"})}))},async downloadVideo(e){try{const t=await b.A.get(e,{responseType:"blob"}),s=new Blob([t.data],{type:"video/mp4"}),i=window.URL.createObjectURL(s),a=document.createElement("a");a.href=i,a.download=e.split("/").pop(),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(i),document.body.removeChild(a)}catch(t){console.error("下载视频失败:",t)}}}}),re=oe,ne=(0,d.A)(re,ie,ae,!1,null,"a8c1a492",null),le=ne.exports,ce=function(){var e=this,t=e._self._c;return t("div",{staticClass:"system"},[t("div",{staticClass:"system-content"},[t("div",{staticClass:"title",on:{click:function(t){return e.goto("/agreement")}}},[e._v("用户协议")]),t("div",{staticClass:"title"},[e._v("隐私政策")]),t("div",{staticClass:"title"},[e._v("产品说明")]),t("div",{staticClass:"title"},[e._v("联系我们")])])])},de=[],ue={name:"system",methods:{goto(e){this.$router.push(e)}}},he=ue,pe=(0,d.A)(he,ce,de,!1,null,"19501b52",null),me=pe.exports,ge=function(){var e=this,t=e._self._c;return t("div",{staticClass:"agreement"},[t("i",{staticClass:"el-icon-back back",on:{click:e.goBack}}),t("div",{staticStyle:{width:"100%","text-align":"center"}},[t("el-radio-group",{model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[t("el-radio-button",{attrs:{label:"声音复刻协议"}}),t("el-radio-button",{attrs:{label:"形象克隆协议"}})],1)],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"iframe-container"},[t("iframe",{attrs:{src:e.docUrl,width:"100%",height:"100%",frameborder:"0"},on:{load:function(t){e.loading=!1}}})])])},ve=[],fe={data(){return{type:"声音复刻协议",docFile:"",loading:!0}},computed:{docUrl(){return this.loading=!0,"声音复刻协议"===this.type?this.docFile="https://live.tellai.tech/files/timbre.docx":this.docFile="https://live.tellai.tech/files/figure.docx",`https://docs.google.com/gview?url=${encodeURIComponent(this.docFile)}&embedded=true`}},methods:{goBack(){this.$router.push("/system")}}},ye=fe,ke=(0,d.A)(ye,ge,ve,!1,null,"0db94300",null),be=ke.exports;i["default"].use(f.A);const we=[{path:"/",name:"ai",component:D},{path:"/figures",name:"figures",component:X},{path:"/voice",name:"voice",component:se},{path:"/video",name:"video",component:le},{path:"/system",name:"system",component:me},{path:"/agreement",name:"agreement",component:be},{path:"/login",name:"Login",component:F},{path:"/register",name:"Register",component:M}],Se=new f.A({mode:"hash",routes:we});var _e=Se,xe=s(1052),Ce=s.n(xe);const $e="task_list",Ae={tasks:JSON.parse(localStorage.getItem($e))||[]},Te={ADD_TASK(e,t){e.tasks.push(t),localStorage.setItem($e,JSON.stringify(e.tasks))},UPDATE_TASK(e,t){const s=e.tasks.findIndex((e=>e.id===t.id));-1!==s&&(e.tasks.splice(s,1,t),localStorage.setItem($e,JSON.stringify(e.tasks)))},REMOVE_TASK(e,t){e.tasks=e.tasks.filter((e=>e.id!==t)),localStorage.setItem($e,JSON.stringify(e.tasks))},SET_TASKS(e,t){e.tasks=t,localStorage.setItem($e,JSON.stringify(t))}},Pe={addTask({commit:e},t){e("ADD_TASK",t)},updateTask({commit:e},t){e("UPDATE_TASK",t)},removeTask({commit:e},t){e("REMOVE_TASK",t)},loadTasks({commit:e}){const t=JSON.parse(localStorage.getItem($e))||[];e("SET_TASKS",t)}},Fe={allTasks:e=>e.tasks};var Ie={namespaced:!0,state:Ae,mutations:Te,actions:Pe,getters:Fe};i["default"].use(J.Ay);const qe=new J.Ay.Store({modules:{task:Ie}});qe.dispatch("task/loadTasks");var Oe=qe;i["default"].prototype.$store=Oe,i["default"].use(Ce()),i["default"].config.productionTip=!1,new i["default"]({router:_e,render:e=>e(v)}).$mount("#app")}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=e,function(){s.amdO={}}(),function(){var e=[];s.O=function(t,i,a,o){if(!i){var r=1/0;for(d=0;d<e.length;d++){i=e[d][0],a=e[d][1],o=e[d][2];for(var n=!0,l=0;l<i.length;l++)(!1&o||r>=o)&&Object.keys(s.O).every((function(e){return s.O[e](i[l])}))?i.splice(l--,1):(n=!1,o<r&&(r=o));if(n){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[i,a,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var a,o,r=i[0],n=i[1],l=i[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(l)var d=l(s)}for(t&&t(i);c<r.length;c++)o=r[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},i=self["webpackChunkoffline_deployment"]=self["webpackChunkoffline_deployment"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],(function(){return s(4661)}));i=s.O(i)})();
//# sourceMappingURL=app.08fcbea2.js.map