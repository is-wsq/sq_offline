(function(){"use strict";var t={3282:function(t,e,s){var i=s(5471),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("dashboard")],1)},o=[],l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("el-container",[e("el-aside",{staticClass:"aside"},[e("span",{staticStyle:{"font-size":"20px","margin-bottom":"20px","font-weight":"bold",color:"#5478FE"}},[t._v("奇点")]),e("div",{staticClass:"aside-menu"},t._l(t.menus,(function(s,i){return e("div",{key:i,staticClass:"menu-group",style:{"background-color":t.active===i?"#e3eaff":"#ffffff"}},[e("div",{staticClass:"menu-item",class:{active:t.active===i,inactive:t.active!==i},attrs:{title:"克隆形象"},on:{click:function(e){return t.changeActive(i,s.path)}}},[e("i",{class:s.class,style:{color:t.active===i?"#FFFFFF":"#8F92A1","font-size":"20px"}})]),e("div",{staticStyle:{"font-size":"12px",color:"#6D7177","margin-top":"5px"}},[t._v(t._s(s.name))])])})),0)]),e("el-main",{staticClass:"main"},[e("router-view")],1)],1)],1)},n=[],r=(s(4114),s(4335)),c={components:{},data(){return{active:0,menus:[{name:"AI大模型",path:"/",class:"el-icon-robot"},{name:"克隆形象",path:"/figures",class:"el-icon-figure"},{name:"克隆声音",path:"/voice",class:"el-icon-voice"},{name:"生成视频",path:"/video",class:"el-icon-video"},{name:"视频列表",path:"/videoList",class:"el-icon-view-list"},{name:"关于我们",path:"/system",class:"el-icon-s-tools"}]}},async mounted(){this.updateActiveFromRoute()},watch:{$route(t){this.updateActiveFromRoute()}},methods:{async queryServiceStatus(){return r.A.get("http://127.0.0.1:11434/api/ps").then((t=>t.data.models.length>0)).catch((t=>!1))},async changeActive(t,e){this.active!==t&&(0===this.active&&await this.queryServiceStatus()?this.$message.error("请先关闭AI大模型服务"):(this.active=t,this.$router.push({path:e})))},updateActiveFromRoute(){for(let t=0;t<this.menus.length;t++)if(this.$route.path===this.menus[t].path){this.active=t;break}console.log("跳转后的active",this.active)}},beforeRouteUpdate(t,e,s){this.updateActiveFromRoute(),s()}},d=c,u=s(1656),m=(0,u.A)(d,l,n,!1,null,null,null),h=m.exports,p={name:"App",components:{dashboard:h},data(){return{pollingTimer:null}},created(){},mounted(){this.$store.dispatch("task/pollVideoTasks"),this.$store.dispatch("task/pollVoiceTasks"),this.$store.dispatch("task/pollFigureTasks"),this.pollingTimer=setInterval((()=>{this.$store.dispatch("task/pollVideoTasks"),this.$store.dispatch("task/pollVoiceTasks"),this.$store.dispatch("task/pollFigureTasks")}),5e3)},beforeDestroy(){clearInterval(this.pollingTimer)}},g=p,f=(0,u.A)(g,a,o,!1,null,null,null),v=f.exports,b=s(173),y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login"},[e("div",{staticClass:"container"},[e("span",{staticStyle:{"font-size":"30px","font-weight":"bold",color:"#5478FE"}},[t._v("奇点")]),e("el-form",{ref:"form",staticClass:"login-form",attrs:{model:t.form,rules:t.rules}},[e("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[e("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),e("el-form-item",{attrs:{label:"密码",prop:"password"}},[e("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),e("el-form-item",[e("el-button",{staticClass:"btn margin-bottom-20",attrs:{type:"primary"},on:{click:t.handleLogin}},[t._v("登录")])],1),e("el-form-item",[e("el-button",{staticClass:"btn",on:{click:t.createAccount}},[t._v("创建账户")])],1)],1)],1)])},x=[];const _="http://127.0.0.1:6006",S=(t=6e4)=>r.A.create({baseURL:_,timeout:t,headers:{"Content-Type":"application/json"}});let k=S();k.interceptors.request.use((t=>t),(t=>Promise.reject(t))),k.interceptors.response.use((t=>({status:t.status,data:t.data})),(t=>(console.log(t),Promise.reject(t))));const w=(t,e={},s=6e4)=>(k=S(s),k.get(t,{params:e})),C=(t,e={},s=6e4)=>(k=S(s),k.post(t,e)),$=(t,e={},s=6e4)=>(k=S(s),k.delete(t,{params:e}));var P={data(){return{form:{phone:"",password:""},rules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"请输入正确的手机号",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符之间",trigger:"blur"}]}}},methods:{handleLogin(){C("/user/login",this.form).then((t=>{"success"===t.data.status?this.$message.success("登录成功"):this.$message.error(t.data.message)}))},createAccount(){this.$router.push({path:"/register"})}}},I=P,T=(0,u.A)(I,y,x,!1,null,"04ec44a9",null),F=T.exports,M=function(){var t=this,e=t._self._c;return e("div",{staticClass:"register"},[e("div",{staticClass:"register-container"},[e("span",{staticStyle:{"font-size":"30px","font-weight":"bold",color:"#5478FE"}},[t._v("奇点")]),e("el-form",{ref:"form",staticClass:"login-form",attrs:{model:t.form,rules:t.rules}},[e("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[e("el-input",{model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),e("el-form-item",{attrs:{label:"密码",prop:"password"}},[e("el-input",{attrs:{type:"password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),e("el-form-item",{attrs:{label:"确认密码",prop:"rePassword"}},[e("el-input",{attrs:{type:"password"},model:{value:t.form.rePassword,callback:function(e){t.$set(t.form,"rePassword",e)},expression:"form.rePassword"}})],1),e("el-form-item",[e("el-button",{staticClass:"btn",on:{click:t.handleLogin}},[t._v("登录")])],1),e("el-form-item",[e("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.createAccount}},[t._v("创建账户")])],1)],1)],1)])},N=[],V={name:"Register",data(){return{form:{phone:"",password:"",rePassword:""},rules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符之间",trigger:"blur"}],rePassword:[{required:!0,message:"请确认密码",trigger:["blur","change"]},{validator:this.checkConfirmPassword,trigger:["blur","change"]}]}}},methods:{handleLogin(){this.$router.push({path:"/"})},checkConfirmPassword(t,e,s){""===e?s(new Error("请确认新密码")):e!==this.form.rePassword?s(new Error("确认密码与新密码不一致")):s()},createAccount(){C("/user/register",this.form).then((t=>{"success"===t.data.status?(this.$message.success("注册成功，请登录"),this.$router.push({path:"/"})):this.$message.error(t.data.message),this.form={}}))}}},R=V,z=(0,u.A)(R,M,N,!1,null,"15625bf8",null),A=z.exports,O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ai"},[e("div",{staticClass:"ai-content"},[e("div",{staticStyle:{display:"flex",height:"40px","align-items":"center",width:"60%"}},[e("span",{staticStyle:{"margin-right":"20px","font-size":"16px",color:"#6d7177"}},[t._v("模型选择")]),e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},t._l(t.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("div",{staticStyle:{display:"flex",height:"40px","align-items":"center",width:"60%","margin-top":"40px"}},[e("span",{staticStyle:{"margin-right":"20px","font-size":"16px",color:"#6d7177"}},[t._v("模型开关")]),e("el-switch",{attrs:{width:50,"active-color":"#6286ED"},on:{change:t.switchChange},model:{value:t.modelOpen,callback:function(e){t.modelOpen=e},expression:"modelOpen"}})],1),e("el-button",{staticClass:"enter-service",on:{click:t.enterService}},[t._v("进入服务")])],1),e("div",{staticStyle:{"margin-top":"74px",color:"#6d7177","font-size":"16px","line-height":"27px"}},[t._v(" 请开启模型后再点击 “进入服务” 使用AI大模型，使用完毕后请关闭模型开关释放资源。 ")]),e("div",{staticStyle:{color:"#6d7177","font-size":"16px","line-height":"27px"}},[t._v(" 注意，模型服务与数字人形象无法同时使用，关闭模型开关即可正常使用数字人服务。 ")])])},D=[],q={data(){return{model:"",options:[{label:"奇点文本审核",value:"doubao-1-5-thinking-pro-250415"}],modelOpen:!1,loading:!1}},async mounted(){this.queryModels(),this.modelOpen=await this.queryServiceStatus()},methods:{queryModels(){w("/get_model_dict").then((t=>{"success"===t.data.status&&(this.options=this.options.concat(t.data.options),this.model=this.options[0].value||"")}))},enterService(){this.modelOpen?window.open("http://127.0.0.1:8080"):this.$message.error("请先开启模型服务")},async queryServiceStatus(){return r.A.get("http://127.0.0.1:11434/api/ps").then((t=>t.data.models.length>0)).catch((t=>!1))},switchChange(t){t?this.startService():this.stopService()},startWebui(){let t={model:this.model};C("start_webui",t).then((t=>{console.log(t)})).catch((t=>{this.$message.error(`webui模型开启失败，${t}`)}))},startService(){this.modelOpen=!1;let t={model:this.model,keep_alive:-1};this.loading=this.$loading({lock:!0,text:"模型服务启动中，请耐心等待...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),C("stop_docker_service").then((e=>{if("success"===e.data.status){if(this.startWebui(),"doubao-1-5-thinking-pro-250415"===this.model)return this.loading.close(),this.loading=null,this.modelOpen=!0,void this.$message.success("模型加载成功");r.A.post("http://127.0.0.1:11434/api/generate",t).then((t=>{t.data.done?(this.modelOpen=!0,this.$message.success("模型加载成功")):(this.modelOpen=!1,this.$message.error(t.data.message)),this.loading.close(),this.loading=null})).catch((t=>{this.loading.close(),this.loading=null,this.modelOpen=!1,this.$message.error("模型加载失败，请稍后重试。")}))}else this.modelOpen=!1,this.loading.close(),this.loading=null,this.$message.error("当前后台有任务在进行中，请稍后再试。")})).catch((t=>{this.modelOpen=!1,this.loading.close(),this.loading=null,this.$message.error("当前后台有任务在进行中，请稍后再试。")}))},stopService(){r.A.get("http://127.0.0.1:11434/api/ps").then((t=>{if(t.data.models.length>0){let e={model:t.data.models[0].model,keep_alive:0};this.modelOpen=!0,r.A.post("http://127.0.0.1:11434/api/generate",e).then((t=>{t.data.done?(this.modelOpen=!1,this.$message.success("模型卸载成功")):(this.modelOpen=!0,this.$message.error(t.data.message))})).catch((t=>{this.modelOpen=!0,this.$message.error("模型卸载失败，请稍后重试。")}))}}))}}},L=q,E=(0,u.A)(L,O,D,!1,null,"2c8a23a4",null),H=E.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"figures"},[e("div",{staticClass:"figures-content"},[e("div",{staticClass:"figure-item"},[e("div",{staticStyle:{"margin-bottom":"10px"}},[t._v("素材")]),e("div",{staticClass:"figures-list"},[t._l(t.processMaterials,(function(i){return e("div",{key:i.id},[e("div",{staticClass:"image-wrapper shining"},[e("el-image",{staticStyle:{width:"120px",height:"158px","border-radius":"8px",filter:"blur(15px)",opacity:"0.8"},attrs:{src:s(4908),fit:"cover"}}),e("div",{staticClass:"shine-layer"}),e("div",{staticClass:"figure-progress"},[e("div",[t._v("素材上传中")]),e("div",{staticStyle:{width:"10px","text-align":"left","margin-left":"5px","font-size":"22px"}},[t._v(t._s(t.dot))])])],1),e("div",{staticClass:"figure-name",attrs:{title:i.name}},[t._v(t._s(i.name))])])})),t._l(t.materials,(function(s,i){return e("div",{key:i,on:{contextmenu:function(e){return e.stopPropagation(),t.handleContextMenu(s,e)},click:function(e){return t.selectItem(s)}}},[e("el-image",{staticClass:"figures-img",attrs:{src:s.picture,fit:"cover"}}),e("div",{staticClass:"figure-name",attrs:{title:s.name}},[t._v(t._s(s.name))])],1)}))],2)]),e("div",{staticClass:"figure-item"},[e("div",{staticStyle:{"margin-bottom":"10px"}},[t._v("形象")]),e("div",{staticClass:"figures-list"},[t._l(t.processTasks,(function(i){return e("div",{key:i.id},[e("div",{staticClass:"image-wrapper shining"},[e("el-image",{staticStyle:{width:"120px",height:"158px","border-radius":"8px",filter:"blur(15px)",opacity:"0.8"},attrs:{src:s(4908),fit:"cover"}}),e("div",{staticClass:"shine-layer"}),e("div",{staticClass:"figure-progress"},[e("div",[t._v("形象克隆中")]),e("div",{staticStyle:{width:"10px","text-align":"left","margin-left":"5px","font-size":"22px"}},[t._v(t._s(t.dot))])])],1),e("div",{staticClass:"figure-name",attrs:{title:i.name}},[t._v(t._s(i.name))])])})),t._l(t.figures,(function(s,i){return e("div",{key:i,on:{contextmenu:function(e){return e.stopPropagation(),t.handleContextMenu(s,e)},click:function(e){return t.selectItem(s)}}},[e("el-image",{staticClass:"figures-img",attrs:{src:s.picture,fit:"cover"}}),e("div",{staticClass:"figure-name",attrs:{title:s.name}},[t._v(t._s(s.name))])],1)}))],2)]),t.rightMenuVisible?e("div",{style:t.menuStyle},[e("div",{staticClass:"right-item",on:{click:t.preview}},[e("i",{staticClass:"el-icon-view menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("预览")])]),e("div",{staticClass:"right-item",on:{click:t.rename}},[e("i",{staticClass:"el-icon-edit-outline menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("重命名")])]),e("div",{staticClass:"right-item",on:{click:t.deleteItem}},[e("i",{staticClass:"el-icon-delete-solid menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("删除")])])]):t._e()]),e("div",{staticStyle:{display:"flex","margin-top":"30px",gap:"100px"}},[e("div",{staticStyle:{"text-align":"end",flex:"1"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://127.0.0.1:6006/figure/clone_only","show-file-list":!1,accept:".mp4, .mov",multiple:"","on-success":t.uploadMaterialsSuccess,"on-error":t.uploadMaterialsError,"before-upload":t.beforeUpload,"on-progress":t.handleFileChange,"file-list":t.MaterialList,data:{lip_sync:!1}},on:{"update:fileList":function(e){t.MaterialList=e},"update:file-list":function(e){t.MaterialList=e}}},[e("el-button",{attrs:{type:"primary"}},[t._v("上传素材")])],1)],1),e("div",{staticStyle:{flex:"1"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://127.0.0.1:6006/figure/clone","show-file-list":!1,accept:".mp4, .mov","on-success":t.uploadSuccess,"on-error":t.uploadError,"before-upload":t.beforeUpload,data:{lip_sync:!0}}},[e("el-button",{attrs:{type:"primary"}},[t._v("添加形象")])],1)],1)]),e("el-dialog",{attrs:{visible:t.dialogVisible,"before-close":t.beforeClose,width:t.aspectRatio>1?"640px":"390px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticStyle:{width:"100%","text-align":"center",position:"relative"}},[e("video",{ref:"video",staticStyle:{"border-radius":"10px",width:"calc(100% - 40px)"},attrs:{src:t.src},on:{ended:function(e){t.isPlaying=!1},loadedmetadata:t.checkAspectRatio}}),e("div",{staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},[t.isPlaying?t._e():e("i",{staticClass:"el-icon-play control-icon",on:{click:t.controlVideo}})])])]),e("el-drawer",{attrs:{title:"重命名形象名称",visible:t.drawer,direction:"rtl"},on:{"update:visible":function(e){t.drawer=e}}},[e("div",{staticStyle:{width:"100%","text-align":"center"}},[e("el-form",{ref:"form",staticStyle:{width:"70%",margin:"0 auto"}},[e("el-form-item",{attrs:{label:"新名称",prop:"newName"}},[e("el-input",{attrs:{placeholder:"请输入新名称"},model:{value:t.newName,callback:function(e){t.newName=e},expression:"newName"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)],1)],1)]),e("div",{staticClass:"figures-footer"},[t._v(" 上传的视频文件格式需为:mp4、mov、MP4、MOV格式；上传的视频文件的时长最少应不低于30秒，建议不超过90秒；上传的视频内容必须符合规范，包含单个人物形象，脸部无遮挡；容量小的原始视频（建议50-100M左右）有利于提高模型速度。 ")])],1)},J=[];s(8111),s(2489),s(7588),s(1701);const Y={data(){return{menuStyle:{position:"fixed",top:"0",left:"0",border:"1px solid #eee","border-radius":"10px","background-color":"#fff","z-index":9999},rightMenuVisible:!1,selectedItem:{}}},methods:{handleContextMenu(t,e){e.preventDefault(),this.rightMenuVisible=!0,this.selectedItem=t,this.selectedId=t.id,this.downloadFilePath=t.video_path||"",this.downloadFileName=t.filename||"",this.menuStyle.left=e.clientX+"px",this.menuStyle.top=e.clientY+"px",document.body.addEventListener("click",this.bodyClick)},bodyClick(){this.rightMenuVisible=!1,this.selectedItem={},document.body.removeEventListener("click",this.bodyClick)}}};var W=s(6278),U={name:"figures",mixins:[Y],data(){return{dialogVisible:!1,drawer:!1,src:"",aspectRatio:0,isPlaying:!1,figureId:null,newName:"",dotCount:1,dotTimer:null,dot:".",MaterialList:[],response_list:[]}},computed:{...(0,W.L8)("task",["figureTasks"]),processMaterials(){return this.figureTasks.filter((t=>"pending"===t.status))},processTasks(){return this.figureTasks.filter((t=>"ready"===t.status))},figures(){return this.figureTasks.filter((t=>"success"===t.status&&t.lip_sync))},materials(){return this.figureTasks.filter((t=>"success"===t.status&&!t.lip_sync))}},mounted(){this.startDotAnimation(),this.$store.dispatch("task/pollFigureTasks")},beforeDestroy(){clearInterval(this.dotTimer)},methods:{startDotAnimation(){this.dotTimer=setInterval((()=>{this.dotCount=this.dotCount%3+1,this.dot=".".repeat(this.dotCount)}),1e3)},selectItem(t){this.selectedItem=t,this.preview()},preview(){this.src=this.selectedItem.filepath,this.dialogVisible=!0},rename(){this.figureId=this.selectedItem.id,this.newName="",this.drawer=!0},onSave(){let t={figure_id:this.figureId,name:this.newName};C("/figure/update_name",t).then((t=>{"success"===t.data.status?(this.$message.success("重命名成功"),this.$store.dispatch("task/pollFigureTasks")):this.$message.error(t.data.message),this.drawer=!1})).catch((t=>{this.$message.error("重命名失败，请稍后重试！")}))},deleteItem(){let t=this.selectedItem.id;$("/figure/delete",{figure_id:t}).then((e=>{if("success"===e.data.status){this.$message.success("删除成功");const e=JSON.parse(sessionStorage.getItem("material_list"))||[],s=e.filter((e=>e!==t));sessionStorage.setItem("material_list",JSON.stringify(s));const i=JSON.parse(sessionStorage.getItem("mention_list"))||[],a=i.filter((e=>e.id!==t));sessionStorage.setItem("mention_list",JSON.stringify(a));let o=JSON.parse(sessionStorage.getItem("figure"))||{};o.id===this.selectedItem.id&&sessionStorage.removeItem("figure"),this.$store.dispatch("task/pollFigureTasks")}else this.$message.error(e.data.message)})).catch((t=>{this.$message.error("删除失败，请稍后重试！")}))},checkAspectRatio(){const t=this.$refs.video,e=t.videoWidth,s=t.videoHeight;this.aspectRatio=e/s},controlVideo(){const t=this.$refs.video;this.isPlaying?(t.pause(),this.isPlaying=!1):(t.play(),this.isPlaying=!0)},beforeClose(){this.isPlaying=!1;const t=this.$refs.video;t.pause(),this.dialogVisible=!1},async beforeUpload(t){return w("/verify/activation").then((t=>"success"===t.data.status||(this.$alert(t.data.message,"验证失败"),Promise.reject("验证失败，停止上传"))))},handleFileChange(t,e,s){this.MaterialList=s},uploadMaterialsError(t){if(this.response_list.push({name:t.name,status:"failed",msg:"上传失败"}),this.response_list.length===this.MaterialList.length){let t=this.response_list.filter((t=>"success"===t.status)).map((t=>t.name)),e=this.response_list.filter((t=>"failed"===t.status)),s="";t.length>0&&(s+=`创建${t.join("、")}素材上传任务成功\n`),e.length>0&&e.forEach((t=>{s+=`创建${t.name}素材上传任务失败，${t.msg}\n`})),this.response_list=[],this.MaterialList=[],this.$alert(s,"任务创建提醒")}},uploadMaterialsSuccess(t,e){if("success"===t.status){if(this.response_list.push({name:e.name,status:"success"}),this.response_list.length===this.MaterialList.length){let t=this.response_list.filter((t=>"success"===t.status)).map((t=>t.name)),e=this.response_list.filter((t=>"failed"===t.status)),s="";t.length>0&&(s+=`创建${t.join("、")}素材上传任务成功\n`),e.length>0&&e.forEach((t=>{s+=`创建${t.name}素材上传任务失败，${t.msg}\n`})),this.response_list=[],this.MaterialList=[],this.$alert(s,"任务创建提醒")}this.$store.dispatch("task/pollFigureTasks")}else if(this.response_list.push({name:e.name,status:"failed",msg:t.message}),this.response_list.length===this.MaterialList.length){let t=this.response_list.filter((t=>"success"===t.status)).map((t=>t.name)),e=this.response_list.filter((t=>"failed"===t.status)),s="";t.length>0&&(s+=`创建${t.join("、")}素材上传任务成功\n`),e.length>0&&e.forEach((t=>{s+=`创建${t.name}素材上传任务失败，${t.msg}\n`})),this.response_list=[],this.MaterialList=[],this.$alert(s,"任务创建提醒")}},uploadError(t){let e=`创建${t.name}形象克隆任务失败`;this.$alert(e,"任务创建提醒")},uploadSuccess(t,e){if("success"===t.status){let t=`已创建${e.name}形象克隆任务，形象克隆成功后会自动更新形象列表`;this.$alert(t,"任务创建提醒"),this.$store.dispatch("task/pollFigureTasks")}else{let s=`创建${e.name}形象克隆任务失败，${t.data}`;this.$alert(s,"任务创建提醒")}}}},X=U,j=(0,u.A)(X,B,J,!1,null,"598df522",null),G=j.exports,K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"voice"},[e("div",{staticClass:"voice-content"},[e("el-row",{staticStyle:{height:"100%",width:"100%",margin:"0 auto"},attrs:{gutter:40}},[e("el-col",{staticStyle:{height:"100%"},attrs:{span:12}},[e("div",{staticClass:"voice-type"},[t._v("系统音色")]),e("div",{staticClass:"voice-list"},t._l(t.systemVoice,(function(s,i){return e("div",{key:i,staticClass:"voice-item",on:{contextmenu:function(e){return e.stopPropagation(),t.handleContextMenu(s,e)}}},[e("div",{staticClass:"voice-icon",on:{click:function(e){return t.textAudio(s)}}},[e("i",{class:s.isPlay?"el-icon-pause":"el-icon-play",staticStyle:{"font-size":"13px",color:"#6286ed"}})]),e("div",{staticClass:"voice-name",attrs:{title:s.name}},[t._v(t._s(s.name))])])})),0)]),e("el-col",{staticStyle:{height:"100%"},attrs:{span:12}},[e("div",{staticClass:"voice-type"},[t._v("克隆音色")]),e("div",{staticClass:"voice-list"},[e("div",{staticClass:"voice-item"},[e("el-upload",{attrs:{action:"http://127.0.0.1:6006/timbres/clone","show-file-list":!1,accept:".mp3, .wav","on-success":t.uploadSuccess,"on-error":t.uploadError,"before-upload":t.beforeUpload}},[e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"80px"}},[e("div",{staticClass:"voice-icon",staticStyle:{"background-color":"pink !important"}},[e("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"15px",color:"red"}})]),e("div",{staticStyle:{width:"80px","margin-left":"10px","font-size":"14px",color:"#101010","text-align":"left"}},[t._v(" 上传音频 ")])])])],1),t._l(t.processVoice,(function(s){return e("div",{key:s.id,staticClass:"voice-item"},[e("div",{staticClass:"voice-icon",staticStyle:{"background-color":"rgba(187, 187, 187, 0.25) !important"}},[e("div",{staticClass:"dot-spinner"},t._l(8,(function(t){return e("div",{key:t,staticClass:"dot",style:{transform:"rotate("+45*t+"deg) translate(0, -9px)",animationDelay:.1*t+"s"}})})),0)]),e("div",{staticClass:"voice-name",attrs:{title:s.name}},[t._v(t._s(s.name))])])})),t._l(t.cloneVoice,(function(s,i){return e("div",{key:i,staticClass:"voice-item",on:{contextmenu:function(e){return e.stopPropagation(),t.handleContextMenu(s,e)}}},[e("div",{staticClass:"voice-icon",on:{click:function(e){return t.textAudio(s)}}},[e("i",{class:s.isPlay?"el-icon-pause":"el-icon-play",staticStyle:{"font-size":"13px",color:"#6286ed"}})]),e("div",{staticClass:"voice-name",attrs:{title:s.name}},[t._v(t._s(s.name))])])}))],2)])],1),t.rightMenuVisible?e("div",{style:t.menuStyle},[e("div",{staticClass:"right-item",on:{click:t.listen}},[e("i",{staticClass:"el-icon-yangshengqi menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("试听")])]),"clone"===t.selectedItem.type?e("div",{staticClass:"right-item",on:{click:t.rename}},[e("i",{staticClass:"el-icon-edit-outline menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("重命名")])]):t._e(),"clone"===t.selectedItem.type?e("div",{staticClass:"right-item",on:{click:t.deleteItem}},[e("i",{staticClass:"el-icon-delete-solid menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("删除")])]):t._e()]):t._e()],1),e("el-drawer",{attrs:{title:"重命名音色名称",visible:t.drawer,direction:"rtl"},on:{"update:visible":function(e){t.drawer=e}}},[e("div",{staticStyle:{width:"100%","text-align":"center"}},[e("el-form",{ref:"form",staticStyle:{width:"70%",margin:"0 auto"}},[e("el-form-item",{attrs:{label:"新名称",prop:"newName"}},[e("el-input",{attrs:{placeholder:"请输入新名称"},model:{value:t.newName,callback:function(e){t.newName=e},expression:"newName"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)],1)],1)]),e("div",{staticClass:"voice-footer"},[t._v(" 请上传格式为mp3\\wav的音频进行声音克隆，建议音频时长为3分钟。请在无遮挡场景进行录制，背景选取纯色无杂物最佳，面部表情丰富，适当添加无指向性手部动作。 ")])],1)},Z=[],Q={name:"Voice",mixins:[Y],data(){return{audio:null,newName:"",drawer:!1,soundId:null,task:{}}},computed:{...(0,W.L8)("task",["voiceTasks"]),processVoice(){return this.voiceTasks.filter((t=>"pending"===t.status))},systemVoice(){return this.voiceTasks.filter((t=>"system"===t.type))},cloneVoice(){return this.voiceTasks.filter((t=>"clone"===t.type&&"success"===t.status))}},mounted(){this.$store.dispatch("task/pollVoiceTasks")},methods:{textAudio(t){this.selectedItem=t,this.listen()},listen(){let t=this.selectedItem;t.isPlay?(this.audio.pause(),this.updateStatus(t,!1)):(this.audio=new Audio(t.filepath),this.audio.play(),this.updateStatus(t,!0),this.audio.onended=()=>{this.updateStatus(t,!1)})},updateStatus(t,e){if("system"===t.type){let s=this.systemVoice.findIndex((e=>e.id===t.id));this.systemVoice[s].isPlay=e}else{let s=this.cloneVoice.findIndex((e=>e.id===t.id));this.cloneVoice[s].isPlay=e}this.$forceUpdate()},rename(){this.soundId=this.selectedItem.id,this.newName="",this.drawer=!0},onSave(){let t={timbre_id:this.soundId,name:this.newName};C("/timbres/update_name",t).then((t=>{"success"===t.data.status?(this.$message.success("重命名成功。"),this.$store.dispatch("task/pollVoiceTasks")):this.$message.error(t.data.message),this.drawer=!1})).catch((t=>{this.$message.error("重命名失败，请稍后重试！")}))},deleteItem(){$(`/timbres/${this.selectedItem.id}`).then((t=>{"success"===t.data.status?(this.$message.success("删除成功。"),this.$store.dispatch("task/pollVoiceTasks")):this.$message.error(t.data.message)})).catch((t=>{this.$message.error("删除失败，请稍后重试！")}))},async beforeUpload(t){return w("/verify/activation").then((t=>"success"===t.data.status||(this.$alert(t.data.message,"验证失败"),Promise.reject("验证失败，停止上传"))))},uploadError(t){let e=`创建${t.name}音色克隆任务失败`;this.$alert(e,"任务创建提醒")},uploadSuccess(t,e){if("success"===t.status){let t=`已创建${e.name}音色克隆任务，音色克隆成功后会自动更新音色列表`;this.$alert(t,"任务创建提醒"),this.$store.dispatch("task/pollVoiceTasks")}else{let s=`创建${e.name}音色克隆任务失败，${t.data}`;this.$alert(s,"任务创建提醒")}}}},tt=Q,et=(0,u.A)(tt,K,Z,!1,null,"6dc16c7b",null),st=et.exports,it=function(){var t=this,e=t._self._c;return e("div",{staticClass:"video"},[e("div",{staticClass:"video-left"},[e("div",{staticClass:"video-header"},[e("div",{staticClass:"video-card-list"},[e("div",{staticStyle:{display:"flex","margin-left":"5px"}},[e("div",{staticClass:"tab-item",class:{"tab-item-active":!t.isMaterial},on:{click:function(e){t.isMaterial=!1}}},[t._v("数字人")]),e("div",{staticClass:"tab-item",class:{"tab-item-active":t.isMaterial},on:{click:function(e){t.isMaterial=!0}}},[t._v("素材")])]),t.isMaterial?e("div",{ref:"videoGrid",staticClass:"video-template",on:{mousedown:t.startSelection,mousemove:t.updateSelection,mouseup:t.endSelection,mouseleave:t.endSelection}},[t._l(t.materials,(function(s){return e("div",{key:s.id,ref:"videoItems",refInFor:!0,staticStyle:{"border-radius":"10px",width:"130px"},style:{"background-color":t.material_list.includes(s.id)?"#e0e7fb":"#FFFFFF"},on:{click:function(e){return e.stopPropagation(),t.selectMaterial(s,e)}}},[e("el-image",{staticClass:"template-img",attrs:{src:s.picture,fit:"cover"}}),e("div",{staticClass:"template-name",attrs:{title:s.name}},[t._v(t._s(s.name))])],1)})),t.isSelecting?e("div",{staticClass:"selection-box",style:{left:`${t.selectionLeft}px`,top:`${t.selectionTop}px`,width:`${t.selectionWidth}px`,height:`${t.selectionHeight}px`}}):t._e()],2):e("div",{staticClass:"video-template"},t._l(t.figures,(function(s){return e("div",{key:s.id,staticStyle:{"border-radius":"10px",width:"130px"},style:{"background-color":s.id===t.figure.id?"#e0e7fb":"#FFFFFF"},on:{click:function(e){return t.selectResource(s)}}},[e("el-image",{staticClass:"template-img",attrs:{src:s.picture,fit:"cover"}}),e("div",{staticClass:"template-name",attrs:{title:s.name}},[t._v(t._s(s.name))])],1)})),0)])]),e("div",{staticStyle:{display:"flex",gap:"10px","margin-top":"10px"}},[e("div",{staticStyle:{flex:"1"}},[e("div",{staticClass:"voice-card"},[e("div",{staticClass:"video-title",staticStyle:{"margin-bottom":"10px"}},[t._v("声音选择")]),e("div",{staticStyle:{display:"flex","align-items":"center"}},[-1!==t.audioIndex?e("div",{staticClass:"play-btn",on:{click:function(e){return t.previewAudio(t.sound,-1)}}},[e("i",{staticClass:"el-icon-play",staticStyle:{"font-size":"13px",color:"#6286ed"}})]):e("div",{staticClass:"play-btn",on:{click:t.stopAudio}},[e("i",{staticClass:"el-icon-pause",staticStyle:{"font-size":"13px",color:"#6286ed"}})]),e("el-popover",{attrs:{placement:"right",trigger:"click"},on:{hide:t.stopAudio}},[e("div",{staticClass:"popover-content"},[e("el-row",t._l(t.voices,(function(s,i){return e("el-col",{key:s.id,attrs:{span:12}},[e("div",{staticClass:"voice-item",class:{active:s.id===t.sound.id},on:{click:function(e){return t.selectVoice(s)}}},[t.audioIndex!==i?e("div",{staticClass:"voice-icon",on:{click:function(e){return t.previewAudio(s,i)}}},[e("i",{staticClass:"el-icon-play",staticStyle:{"font-size":"13px",color:"#6286ed"}})]):e("div",{staticClass:"voice-icon",on:{click:t.stopAudio}},[e("i",{staticClass:"el-icon-pause",staticStyle:{"font-size":"13px",color:"#6286ed"}})]),e("div",{staticClass:"voice-name",attrs:{title:s.name}},[t._v(t._s(s.name))])])])})),1)],1),e("div",{staticClass:"sound",attrs:{slot:"reference"},slot:"reference"},[e("div",{staticClass:"sound-name",attrs:{title:t.sound.name}},[t._v(t._s(t.sound.name))]),e("i",{staticClass:"el-icon-a-ze-bars1",staticStyle:{"font-size":"20px",color:"#9a9a9a"}})])])],1)])]),e("div",{staticStyle:{flex:"1"}},[e("div",{staticClass:"voice-card"},[e("div",{staticClass:"video-title",staticStyle:{"margin-bottom":"10px"}},[t._v("背景音乐")]),e("div",{staticStyle:{display:"flex","align-items":"center"}},[-2!==t.audioIndex?e("div",{staticClass:"play-btn",on:{click:function(e){return t.previewAudio(t.bgm,-2)}}},[e("i",{staticClass:"el-icon-play",staticStyle:{"font-size":"13px",color:"#6286ed"}})]):e("div",{staticClass:"play-btn",on:{click:t.stopAudio}},[e("i",{staticClass:"el-icon-pause",staticStyle:{"font-size":"13px",color:"#6286ed"}})]),e("el-popover",{attrs:{placement:"bottom",trigger:"click"},on:{hide:t.stopAudio}},[e("div",{staticClass:"popover-content"},[e("el-row",[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"voice-item"},[e("el-upload",{attrs:{action:"http://127.0.0.1:6006/bgm/upload","show-file-list":!1,accept:".mp3, .wav","on-success":t.bgmUploadSuccess}},[e("div",{staticStyle:{display:"flex","align-items":"center",height:"80px"}},[e("div",{staticClass:"voice-icon",staticStyle:{"background-color":"pink !important"}},[e("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"15px",color:"red"}})]),e("div",{staticClass:"voice-name",staticStyle:{"text-align":"left"}},[t._v("上传背景音乐")])])])],1)]),t._l(t.bgmList,(function(s,i){return e("el-col",{key:s.id,attrs:{span:12}},[e("div",{staticClass:"voice-item",class:{active:s.id===t.bgm.id},on:{click:function(e){return t.selectBgm(s)}}},[t.audioIndex!==1e4+i?e("div",{staticClass:"voice-icon",on:{click:function(e){return t.previewAudio(s,1e4+i)}}},[e("i",{class:s.isPlay?"el-icon-pause":"el-icon-play",staticStyle:{"font-size":"13px",color:"#6286ed"}})]):e("div",{staticClass:"voice-icon",on:{click:t.stopAudio}},[e("i",{staticClass:"el-icon-pause",staticStyle:{"font-size":"13px",color:"#6286ed"}})]),e("div",{staticClass:"voice-name",attrs:{title:s.name}},[t._v(t._s(s.name))])])])}))],2)],1),e("div",{staticClass:"sound",attrs:{slot:"reference"},slot:"reference"},[e("div",{staticClass:"sound-name",attrs:{title:t.bgm.name}},[t._v(t._s(t.bgm.name))]),e("i",{staticClass:"el-icon-a-ze-bars1",staticStyle:{"font-size":"20px",color:"#9a9a9a"}})])]),e("div",{staticStyle:{margin:"0 10px","font-size":"13px",color:"#303133"}},[t._v("音量")]),e("el-slider",{staticStyle:{width:"90px"},attrs:{step:.1,min:.1,max:1},on:{change:function(e){return t.saveBgmVolume("bg_volume")}},model:{value:t.bg_volume,callback:function(e){t.bg_volume=e},expression:"bg_volume"}})],1)])])]),t.with_text?e("div",[e("div",{staticClass:"voice-card",staticStyle:{"margin-top":"10px",position:"relative"}},[e("div",{staticStyle:{height:"21px",width:"100%",position:"absolute",top:"15px",left:"0","z-index":"99",cursor:"pointer"},attrs:{title:"点击展开或收起"},on:{click:t.updateSubtitleSetting}}),t.subtitleSetting.length>0?e("div",{staticStyle:{display:"flex",position:"absolute",top:"15px",left:"50%",transform:"translateX(-50%)","z-index":"100"}},[e("div",{staticClass:"tab-item",class:{"tab-item-active":!t.isText},on:{click:function(e){t.isText=!1}}},[t._v("口播标题")]),e("div",{staticClass:"tab-item",class:{"tab-item-active":t.isText},on:{click:function(e){t.isText=!0}}},[t._v("口播内容")])]):t._e(),e("el-collapse",{model:{value:t.subtitleSetting,callback:function(e){t.subtitleSetting=e},expression:"subtitleSetting"}},[t.isText?t._e():e("el-collapse-item",{attrs:{title:"字幕设置",name:"1"}},[e("el-switch",{staticStyle:{"margin-top":"25px","margin-bottom":"15px"},attrs:{width:50,"inactive-text":"字幕开关"},on:{change:t.switchTitle},model:{value:t.withTitle,callback:function(e){t.withTitle=e},expression:"withTitle"}}),e("div",{staticClass:"preset"},[e("span",{staticStyle:{"margin-right":"20px"}},[t._v("预设样式")]),t._l(t.titlePresets,(function(s){return e("div",{key:s.id,staticClass:"preset-style",style:{backgroundColor:s.backgroundColor,color:s.color,"-webkit-text-stroke":"0.5px"+s.stroke,border:t.activeTitlePresetId===s.id?"2px solid #6286ed":"none"},on:{click:function(e){return t.selectTitlePreset(s)}}},[t._v(" T ")])}))],2),e("div",{staticStyle:{display:"flex",gap:"30px","align-items":"center",height:"80px"}},[e("div",[e("div",{staticStyle:{"font-size":"13px",height:"40px"}},[t._v("字体样式")]),e("el-select",{staticStyle:{height:"35px",width:"180px"},attrs:{placeholder:"请选择"},on:{change:function(e){return t.saveSubtitleNameParams("name_font")}},model:{value:t.subtitleNameParams.name_font,callback:function(e){t.$set(t.subtitleNameParams,"name_font",e)},expression:"subtitleNameParams.name_font"}},t._l(t.fontFamily,(function(s){return e("el-option",{key:s.font_id,attrs:{label:s.name,value:s.font_id}},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("img",{staticStyle:{width:"150px",height:"50px","margin-right":"8px"},attrs:{src:s.img_path}}),e("span",[t._v(t._s(s.name))])])])})),1)],1),e("div",[e("div",{staticStyle:{"font-size":"13px",height:"35px"}},[t._v("字体大小")]),e("div",{staticStyle:{display:"flex"}},[e("el-slider",{staticStyle:{width:"170px"},attrs:{min:5,max:50},on:{change:function(e){return t.saveSubtitleNameParams("name_fontsize")}},model:{value:t.subtitleNameParams.name_fontsize,callback:function(e){t.$set(t.subtitleNameParams,"name_fontsize",e)},expression:"subtitleNameParams.name_fontsize"}}),e("el-input-number",{staticClass:"text-input",staticStyle:{"margin-left":"10px",width:"80px !important"},attrs:{"controls-position":"right",min:5,max:50},on:{change:function(e){return t.saveSubtitleNameParams("name_fontsize")}},model:{value:t.subtitleNameParams.name_fontsize,callback:function(e){t.$set(t.subtitleNameParams,"name_fontsize",e)},expression:"subtitleNameParams.name_fontsize"}})],1)]),e("div",{staticStyle:{"text-align":"center"}},[e("div",{staticStyle:{"font-size":"13px",height:"40px"}},[t._v("字体颜色")]),e("el-color-picker",{attrs:{size:"small"},on:{change:function(e){return t.saveSubtitleNameParams("name_color")}},model:{value:t.subtitleNameParams.name_color,callback:function(e){t.$set(t.subtitleNameParams,"name_color",e)},expression:"subtitleNameParams.name_color"}})],1),e("div",{staticStyle:{"text-align":"center"}},[e("div",{staticStyle:{"font-size":"13px",height:"40px"}},[t._v("描边颜色")]),e("el-color-picker",{attrs:{size:"small"},on:{change:function(e){return t.saveSubtitleNameParams("name_stroke_color")}},model:{value:t.subtitleNameParams.name_stroke_color,callback:function(e){t.$set(t.subtitleNameParams,"name_stroke_color",e)},expression:"subtitleNameParams.name_stroke_color"}})],1),e("div",{staticStyle:{"text-align":"center"}},[e("div",{staticStyle:{"font-size":"13px",height:"40px"}},[t._v("背景颜色")]),e("el-color-picker",{attrs:{"show-alpha":"",size:"small"},on:{change:function(e){return t.saveSubtitleNameParams("name_background_color")}},model:{value:t.subtitleNameParams.name_background_color,callback:function(e){t.$set(t.subtitleNameParams,"name_background_color",e)},expression:"subtitleNameParams.name_background_color"}})],1)])],1),t.isText?e("el-collapse-item",{attrs:{title:"字幕设置",name:"1"}},[e("el-switch",{staticStyle:{"margin-top":"25px","margin-bottom":"15px"},attrs:{width:50,"inactive-text":"字幕开关"},on:{change:t.switchSubtitle},model:{value:t.withSubtitle,callback:function(e){t.withSubtitle=e},expression:"withSubtitle"}}),e("div",{staticClass:"preset"},[e("span",{staticStyle:{"margin-right":"20px"}},[t._v("预设样式")]),t._l(t.titlePresets,(function(s){return e("div",{key:s.id,staticClass:"preset-style",style:{backgroundColor:s.backgroundColor,color:s.color,"-webkit-text-stroke":"0.5px"+s.stroke,border:t.activePresetId===s.id?"2px solid #6286ed":"none"},on:{click:function(e){return t.selectPreset(s)}}},[t._v(" T ")])}))],2),e("div",{staticStyle:{display:"flex",gap:"30px","align-items":"center",height:"80px"}},[e("div",[e("div",{staticStyle:{"font-size":"13px",height:"40px"}},[t._v("字体样式")]),e("el-select",{staticStyle:{height:"35px",width:"180px"},attrs:{placeholder:"请选择"},on:{change:function(e){return t.saveSubtitleParams("font")}},model:{value:t.subtitleParams.font,callback:function(e){t.$set(t.subtitleParams,"font",e)},expression:"subtitleParams.font"}},t._l(t.fontFamily,(function(s){return e("el-option",{key:s.font_id,attrs:{label:s.name,value:s.font_id}},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("img",{staticStyle:{width:"150px",height:"50px","margin-right":"8px"},attrs:{src:s.img_path}}),e("span",[t._v(t._s(s.name))])])])})),1)],1),e("div",[e("div",{staticStyle:{"font-size":"13px",height:"35px"}},[t._v("字体大小")]),e("div",{staticStyle:{display:"flex"}},[e("el-slider",{staticStyle:{width:"170px"},attrs:{min:5,max:50},on:{change:function(e){return t.saveSubtitleParams("fontsize")}},model:{value:t.subtitleParams.fontsize,callback:function(e){t.$set(t.subtitleParams,"fontsize",e)},expression:"subtitleParams.fontsize"}}),e("el-input-number",{staticClass:"text-input",staticStyle:{"margin-left":"10px",width:"80px !important"},attrs:{"controls-position":"right",min:5,max:50},on:{change:function(e){return t.saveSubtitleParams("fontsize")}},model:{value:t.subtitleParams.fontsize,callback:function(e){t.$set(t.subtitleParams,"fontsize",e)},expression:"subtitleParams.fontsize"}})],1)]),e("div",{staticStyle:{"text-align":"center"}},[e("div",{staticStyle:{"font-size":"13px",height:"40px"}},[t._v("字体颜色")]),e("el-color-picker",{attrs:{size:"small"},on:{change:function(e){return t.saveSubtitleParams("color")}},model:{value:t.subtitleParams.color,callback:function(e){t.$set(t.subtitleParams,"color",e)},expression:"subtitleParams.color"}})],1),e("div",{staticStyle:{"text-align":"center"}},[e("div",{staticStyle:{"font-size":"13px",height:"40px"}},[t._v("描边颜色")]),e("el-color-picker",{attrs:{size:"small"},on:{change:function(e){return t.saveSubtitleParams("stroke_color")}},model:{value:t.subtitleParams.stroke_color,callback:function(e){t.$set(t.subtitleParams,"stroke_color",e)},expression:"subtitleParams.stroke_color"}})],1),e("div",{staticStyle:{"text-align":"center"}},[e("div",{staticStyle:{"font-size":"13px",height:"40px"}},[t._v("背景颜色")]),e("el-color-picker",{attrs:{"show-alpha":"",size:"small"},on:{change:function(e){return t.saveSubtitleParams("background_color")}},model:{value:t.subtitleParams.background_color,callback:function(e){t.$set(t.subtitleParams,"background_color",e)},expression:"subtitleParams.background_color"}})],1)])],1):t._e()],1)],1),e("div",{staticClass:"text-card"},[e("div",{staticStyle:{display:"flex","margin-bottom":"10px","align-items":"center"}},[e("div",{staticClass:"video-title",staticStyle:{flex:"1"}},[t._v("智能成片")]),e("div",{staticClass:"ai-generate-btn",on:{click:t.openSetting}},[t._v("AI生成文案")])]),e("div",{staticStyle:{height:"calc(100% - 65px)"}},[e("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"empty-text":"暂未设置",stripe:"",height:"100%","tooltip-effect":"light"},on:{"row-click":t.handleRowClick}},[e("el-table-column",{attrs:{type:"index",label:"",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticStyle:{position:"relative",width:"100%",cursor:"pointer"},attrs:{title:"点击行可编辑"}},[e("div",[t._v(t._s(s.$index+1))]),t.withTitle&&!s.row.title?e("div",{staticClass:"warning",attrs:{title:"已开启字幕标题设置，口播标题不能为空"}},[e("i",{staticClass:"el-icon-info",staticStyle:{color:"red","font-size":"16px"}})]):t._e()])]}}],null,!1,2423005768)}),e("el-table-column",{attrs:{prop:"title",label:"口播标题","header-align":"center",width:"250","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"table-column",attrs:{title:"点击行可编辑"}},[t._v(t._s(s.row.title))])]}}],null,!1,755333790)}),e("el-table-column",{attrs:{prop:"text",label:"口播内容","header-align":"center","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"table-column",attrs:{title:"点击行可编辑"}},[t._v(t._s(s.row.text))])]}}],null,!1,3427500195)}),e("el-table-column",{attrs:{label:"",width:"90",align:"center","class-name":"no-border-column"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return e.stopPropagation(),t.deleteRow(s.$index)}}},[t._v("删除")])]}}],null,!1,3019405730)})],1)],1),e("el-button",{staticStyle:{"margin-top":"5px"},attrs:{type:"primary",size:"small"},on:{click:t.addTable}},[t._v("添加口播文案")])],1)]):t._e(),t.with_text?t._e():e("div",[t._v(" 后需添加用户输入视频时长和生成的视频个数 ")]),e("div",{staticStyle:{height:"50px",display:"flex","align-items":"center"}},[e("el-switch",{attrs:{width:50,"inactive-text":"AI混剪"},on:{change:t.switchMontage},model:{value:t.montage,callback:function(e){t.montage=e},expression:"montage"}}),e("div",{staticStyle:{margin:"0 20px",width:"80px"}},[t.montage?e("span",{staticStyle:{"font-size":"13px",color:"#409EFF",cursor:"pointer"},on:{click:t.openMontageDialog}},[t._v("混剪配置")]):t._e()]),e("el-switch",{staticStyle:{"margin-right":"50px"},attrs:{width:50,"inactive-text":"视频倒序循环"},on:{change:t.switchReverse},model:{value:t.reverse,callback:function(e){t.reverse=e},expression:"reverse"}})],1),e("el-button",{staticClass:"generate-btn",attrs:{type:"primary"},on:{click:t.verify}},[t._v("生成视频")]),e("el-dialog",{attrs:{title:"AI生成文案配置",visible:t.dialogVisible,width:"70%","show-close":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticStyle:{height:"50vh","overflow-y":"auto"}},[e("el-form",{attrs:{model:t.form,"label-width":"80px","label-position":"top"}},[e("el-form-item",{attrs:{label:"模型选择"}},[e("el-select",{on:{change:t.modelChange},model:{value:t.ai_model,callback:function(e){t.ai_model=e},expression:"ai_model"}},t._l(t.AIOptions,(function(s){return e("el-option",{key:s.value,attrs:{label:s.label,value:s.value,disabled:"local_model"===s.value&&t.serverIsRunning}})})),1)],1),e("el-form-item",{attrs:{label:"示例文案"}},[t._l(t.exampleTexts,(function(s,i){return e("div",{key:i,staticClass:"input-row"},[e("el-input",{staticClass:"input-with-button",attrs:{type:"textarea",rows:"3",placeholder:"请输入示例文案"},model:{value:t.exampleTexts[i],callback:function(e){t.$set(t.exampleTexts,i,e)},expression:"exampleTexts[index]"}}),e("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(e){return t.removeText(i)}}})],1)})),e("el-button",{staticClass:"add-button",attrs:{type:"primary"},on:{click:t.addExampleText}},[t._v(" 添加示例文案 ")])],2),e("el-form-item",{attrs:{label:"文案要求"}},[e("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入文案要求"},model:{value:t.requirements,callback:function(e){t.requirements=e},expression:"requirements"}})],1),e("el-row",[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"文案字数"}},[e("el-select",{model:{value:t.num_of_words,callback:function(e){t.num_of_words=e},expression:"num_of_words"}},t._l(t.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"文案数量"}},[e("el-input",{staticClass:"text_setting",staticStyle:{width:"200px"},attrs:{type:"number"},model:{value:t.script_count,callback:function(e){t.script_count=e},expression:"script_count"}})],1)],1)],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.dialogClose}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary",disabled:t.disableBtn},on:{click:t.generateText}},[t._v("生 成")])],1)]),e("el-dialog",{attrs:{title:"编辑文案",visible:t.editDialogVisible,width:"70%","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.editDialogVisible=e}}},[e("el-form",{ref:"editForm",attrs:{model:t.selectedRow,rules:t.rules,"label-width":"80px","label-position":"top"}},[e("el-form-item",{attrs:{label:"口播标题",prop:"title"}},[e("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"输入口播标题"},model:{value:t.selectedRow.title,callback:function(e){t.$set(t.selectedRow,"title",e)},expression:"selectedRow.title"}})],1),e("el-form-item",{attrs:{label:"口播内容",prop:"text"}},[e("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"输入口播内容"},model:{value:t.selectedRow.text,callback:function(e){t.$set(t.selectedRow,"text",e)},expression:"selectedRow.text"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:t.cancelEdit}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.saveEditRow}},[t._v("保 存")])],1)],1),e("el-dialog",{attrs:{title:"AI混剪配置",visible:t.montageDialogVisible,width:"70%","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.montageDialogVisible=e}}},[e("el-form",{ref:"montageForm",attrs:{model:t.montageForm,"label-width":"80px","label-position":"top"}},[e("el-form-item",{attrs:{label:"混剪要求",prop:"title"}},[e("div",{staticStyle:{position:"relative"}},[e("div",{ref:"highlightDiv",staticClass:"highlight-content",style:{height:t.replaceDivHeight+"px",overflowY:"auto",overflowX:"hidden"},domProps:{innerHTML:t._s(t.highlightedText)}}),e("el-input",{ref:"inputRef",staticClass:"input-layer",attrs:{type:"textarea",rows:"4",placeholder:"输入混剪要求"},on:{input:t.onInput,scroll:t.handleScroll},model:{value:t.montageForm.request,callback:function(e){t.$set(t.montageForm,"request",e)},expression:"montageForm.request"}}),t.showDropdown?e("div",{staticClass:"dropdown",style:t.dropdownStyle},[e("ul",t._l(t.mentionList,(function(s,i){return e("li",{key:i,on:{click:function(e){return t.selectMention(s)}}},[t._v(" "+t._s(s.name)+" ")])})),0)]):t._e()],1)])],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.closeMontageDialog}},[t._v("确 定")])],1)],1)],1),e("div",{staticClass:"video-right"},[e("div",{ref:"container",staticClass:"preview-setting",on:{mousemove:t.onMouseMove,mouseup:t.onMouseUp,mouseleave:t.onMouseUp}},[t.figure.picture?e("el-image",{staticStyle:{width:"100%"},attrs:{src:t.figure.picture,fit:"cover"}}):t.mentionList[0]?e("el-image",{staticStyle:{width:"100%"},attrs:{src:t.mentionList[0].picture,fit:"cover"}}):e("div",{staticStyle:{width:"100%",height:"600px"}}),t.withTitle?e("div",{ref:"titleContainer",staticClass:"preview-title",style:t.titleTextStyle,on:{mousedown:function(e){return t.onMouseDown("top",e)}}},[t._v(" 示例标题 ")]):t._e(),t.withSubtitle?e("div",{ref:"contentContainer",staticClass:"preview-content",style:t.textStyle,on:{mousedown:function(e){return t.onMouseDown("bottom",e)}}},[t._v(" 示例字幕 ")]):t._e()],1)])])},at=[],ot=(s(3579),s(1303));const lt={data(){return{lastClickedIndex:null,isSelecting:!1,initialX:0,initialY:0,selectionLeft:0,selectionTop:0,selectionWidth:0,selectionHeight:0,initial_material_list:[]}},methods:{startSelection(t){if(0!==t.button)return;t.preventDefault(),t.stopPropagation();const e=this.$refs.videoGrid,s=this.$el.getBoundingClientRect();this.initialX=t.clientX-s.left,this.initialY=t.clientY-s.top-30+e.scrollTop,this.selectionLeft=this.initialX,this.selectionTop=this.initialY,this.selectionWidth=0,this.selectionHeight=0,this.isSelecting=!0,this.initial_material_list=[...this.material_list]},updateSelection(t){if(!this.isSelecting)return;const e=this.$refs.videoGrid,s=this.$el.getBoundingClientRect(),i=t.clientX-s.left,a=t.clientY-s.top-30+e.scrollTop;this.selectionLeft=Math.min(this.initialX,i),this.selectionTop=Math.min(this.initialY,a),this.selectionWidth=Math.abs(i-this.initialX),this.selectionHeight=Math.abs(a-this.initialY),this.updateSelectedItems()},endSelection(){this.isSelecting&&(this.isSelecting=!1,this.selectionWidth=0,this.selectionHeight=0)},updateSelectedItems(){const t={left:this.selectionLeft,top:this.selectionTop,right:this.selectionLeft+this.selectionWidth,bottom:this.selectionTop+this.selectionHeight};this.$refs.videoItems.forEach(((e,s)=>{const i=e.getBoundingClientRect(),a=this.$el.getBoundingClientRect(),o=this.$refs.videoGrid,l={left:i.left-a.left,top:i.top-a.top-30+o.scrollTop,right:i.right-a.left,bottom:i.bottom-a.top-30+o.scrollTop},n=l.left<t.right&&l.right>t.left&&l.top<t.bottom&&l.bottom>t.top;let r=this.materials[s].id;n&&!this.material_list.includes(r)&&this.material_list.push(r),n||this.initial_material_list.includes(r)||(this.material_list=this.material_list.filter((t=>t!==r)))})),sessionStorage.setItem("material_list",JSON.stringify(this.material_list))}}};var nt={name:"Video",mixins:[lt],data(){return{isPlay:!1,templates:[],isMaterial:!1,isText:!1,materials:[],figures:[],figure:{},material_list:[],voices:[],sound:{},bgmList:[],bgm:{},bg_volume:.5,with_text:!0,with_time:30,video_num:1,text:"",audio:null,audioIndex:null,isFocus:!1,reverse:!1,withSubtitle:!1,subtitleParams:{},withTitle:!1,subtitleNameParams:{},titleTextStyle:{},textStyle:{},fontFamily:[],subtitleSetting:[],activeTitleNames:[],activeNames:[],subtitle:"",tableData:[],dialogVisible:!1,form:{},editDialogVisible:!1,selectedRow:{},selectedIndex:0,rules:{title:[{required:!1,message:"请输入口播文案",trigger:"blur"}],text:[{required:!0,message:"请输入口播文案",trigger:"blur"}]},dialogType:"edit",ai_model:"deepseek_v3",serverIsRunning:!1,AIOptions:[{label:"本地大模型",value:"local_model"},{label:"deepseek v3",value:"deepseek_v3"}],exampleTexts:[],requirements:"",num_of_words:100,options:[{label:"100",value:100},{label:"200",value:200},{label:"300",value:300},{label:"400",value:400},{label:"500",value:500},{label:"600",value:600}],script_count:1,disableBtn:!1,montage:!1,montageDialogVisible:!1,montageForm:{request:""},lastInput:"",actualRequest:"",mentionRanges:[],showDropdown:!1,dropdownStyle:{position:"absolute",top:"0px",left:"0px"},replaceDivHeight:40,titleWidth:0,titlePresets:[{id:"1",fontFamily:"SJxingkai-C-Regular",backgroundColor:"rgba(64,64,64,0.6)",stroke:"#000000",color:"#ffffff"},{id:"2",fontFamily:"SJxingkai-C-Regular",backgroundColor:"rgba(64,64,64,0.6)",stroke:"#ffffff",color:"#000000"},{id:"3",fontFamily:"SJxingkai-C-Regular",backgroundColor:"rgba(64,64,64,0.6)",stroke:"#FC0202",color:"#FDFF00"},{id:"4",fontFamily:"SJxingkai-C-Regular",backgroundColor:"rgba(64,64,64,0.6)",stroke:"#FDFF00",color:"#FC0202"},{id:"5",fontFamily:"LXGW-ZhenKai",backgroundColor:"rgba(200, 200, 200, 0.6)",stroke:"#000000",color:"#ffffff"},{id:"6",fontFamily:"LXGW-ZhenKai",backgroundColor:"rgba(200, 200, 200, 0.6)",stroke:"#ffffff",color:"#000000"},{id:"7",fontFamily:"LXGW-ZhenKai",backgroundColor:"rgba(200, 200, 200, 0.6)",stroke:"#FC0202",color:"#FDFF00"},{id:"8",fontFamily:"LXGW-ZhenKai",backgroundColor:"rgba(200, 200, 200, 0.6)",stroke:"#FDFF00",color:"#FC0202"}],activeTitlePresetId:"1",activePresetId:"1",dragging:!1,draggingType:"",startY:0,topOffset:0,bottomOffset:100}},computed:{mentionList(){return this.materials.filter((t=>this.material_list.includes(t.id))).sort(((t,e)=>this.material_list.indexOf(t.id)-this.material_list.indexOf(e.id)))},highlightedText(){let t=this.montageForm.request,e=this.mentionList.map((t=>"@"+t.name));return e.forEach((e=>{const s=new RegExp(`${e}`,"g");t=t.replace(s,(t=>`<span style="color: #4c8df1">${t}</span>`))})),t=t.replace(/\n/g,"<br>"),t}},mounted(){this.querySounds(),this.queryFigures(),this.queryFontFamily(),this.queryBgm(),document.addEventListener("click",this.handleClickOutside),this.$nextTick((()=>{this.initParams()}))},beforeDestroy(){this.stopAudio(),document.removeEventListener("click",this.handleClickOutside)},methods:{updateSubtitleSetting(){this.subtitleSetting=0===this.subtitleSetting.length?["1"]:[]},onMouseDown(t,e){this.dragging=!0,this.draggingType=t,this.startY=e.clientY},onMouseMove(t){if(!this.dragging)return;const e=t.clientY-this.startY;this.startY=t.clientY;const s=this.$refs.container.clientHeight,i=this.$refs.titleContainer.clientHeight,a=this.$refs.contentContainer.clientHeight;if("top"===this.draggingType){let t=this.topOffset+e;t=Math.max(0,Math.min(this.bottomOffset-i,t)),this.topOffset=t,this.updateTitleTextStyle()}if("bottom"===this.draggingType){let t=this.bottomOffset+e;t=Math.max(this.topOffset+i,Math.min(s-a,t)),this.bottomOffset=t,this.updateTextStyle()}},onMouseUp(){this.dragging=!1},handleScroll(t){const e=t.target.scrollTop,s=this.$refs.highlightDiv;s&&(s.scrollTop=e)},updateMentionRanges(){let t=[],e=this.mentionList.map((t=>"@"+t.name));e.forEach((e=>{let s=0;while(-1!==(s=this.montageForm.request.indexOf(e,s)))t.push({start:s+1,end:s+e.length,name:e}),s+=e.length})),this.mentionRanges=t},onInput(){let t=this.lastInput.length>this.montageForm.request.length;this.lastInput=this.montageForm.request;const e=this.$refs.inputRef.$el.querySelector("textarea"),s=e.selectionStart;if(t)for(let o of this.mentionRanges){const{start:t,end:e,name:i}=o;s>=t&&s<e&&(this.montageForm.request=this.montageForm.request.slice(0,t-1)+this.montageForm.request.slice(e-1))}this.updateMentionRanges();const i=this.montageForm.request.slice(0,s),a="@"===i.charAt(i.length-1);a?(this.showDropdown=!0,this.$nextTick((()=>{const t=parseFloat(getComputedStyle(e).paddingLeft)||0,s=document.createElement("canvas"),a=s.getContext("2d"),o=getComputedStyle(e);a.font=`${o.fontSize} ${o.fontFamily}`;const l=a.measureText(i).width,n=e.clientWidth-30,r=parseFloat(o.lineHeight)||parseFloat(o.fontSize);let c=Math.floor((t+l+10)/n)+1;c=Math.min(c,4);let d=(t+l+5)%n;this.dropdownStyle.top=`${window.scrollY+c*r}px`,this.dropdownStyle.left=`${d}px`}))):this.showDropdown=!1},selectMention(t){const e=this.$refs.inputRef.$el.querySelector("textarea"),s=e.selectionStart,i=this.montageForm.request.lastIndexOf("@",s-1);-1!==i&&(this.montageForm.request=this.montageForm.request.slice(0,i)+"@"+t.name+this.montageForm.request.slice(s),this.showDropdown=!1,this.lastInput=this.montageForm.request,this.updateMentionRanges(),e.selectionStart=this.mentionRanges[this.mentionRanges.length-1].end,e.selectionEnd=this.mentionRanges[this.mentionRanges.length-1].end)},handleClickOutside(t){if(!this.$refs.inputRef)return;const e=this.$refs.inputRef.$el.querySelector("textarea"),s=this.$refs.dropdownRef;e.contains(t.target)||s&&s.contains(t.target)||(this.showDropdown=!1)},generateText(){let t="";switch(this.ai_model){case"local_model":t="http://127.0.0.1:9669/generate_script";break;case"deepseek_v3":t="http://127.0.0.1:9669/api/generate_script";break}const e=this.exampleTexts.map((t=>t.trim())).filter((t=>""!==t));let s={examples:e,requirements:this.requirements,num_of_words:parseInt(this.num_of_words),script_count:parseInt(this.script_count)};this.loading=this.$loading({lock:!0,text:"文案生成中，请耐心等待...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r.A.post(t,s).then((t=>{"success"===t.data.status?(this.tableData=this.tableData.concat(t.data.data.map((t=>({id:(0,ot.A)(),title:"",text:t})))),sessionStorage.setItem("tableData",JSON.stringify(this.tableData))):this.$notify({title:"文案生成失败",message:`${t.data.message}`,type:"error",duration:0}),this.dialogClose()})).catch((t=>{this.$notify({title:"文案生成失败",message:`${t}`,type:"error",duration:0}),this.dialogClose()}))},addExampleText(){this.exampleTexts.push("")},removeText(t){this.exampleTexts.splice(t,1)},dialogClose(){this.exampleTexts=[],this.requirements="",this.num_of_words=100,this.script_count=1,this.loading&&(this.loading.close(),this.loading=null),this.dialogVisible=!1},async openSetting(){this.serverIsRunning=await this.judgeServeStatus(),this.dialogVisible=!0},modelChange(){"local_model"===this.ai_model?(this.disableBtn=!0,C("stop_docker_service").then((t=>{"success"===t.data.status&&(this.disableBtn=!1)}))):this.disableBtn=!1},async judgeServeStatus(){return!!(await this.figureRun()||await this.timbreRun()||await this.videoRun())},async figureRun(){return w("/figure/query_success").then((t=>{let e=t.data.data.filter((t=>"ready"===t.status));return e.length>0}))},async timbreRun(){return w("/timbres/query_success").then((t=>{let e=t.data.data.filter((t=>"pending"===t.status));return e.length>0}))},async videoRun(){return w("/video_record/query").then((t=>{let e=t.data.data.filter((t=>"pending"===t.status));return e.length>0}))},addTable(){this.tableData.push({id:(0,ot.A)(),title:"",text:""}),this.$nextTick((()=>{const t=this.$refs.table.bodyWrapper;t.scrollTop=t.scrollHeight})),this.editRow(this.tableData.length-1,"add")},deleteRow(t){this.tableData.splice(t,1),sessionStorage.setItem("tableData",JSON.stringify(this.tableData))},handleRowClick(t){let e=this.tableData.indexOf(t);this.editRow(e)},editRow(t,e="edit"){this.selectedRow={...this.tableData[t]},this.selectedIndex=t,this.rules.title[0].required=this.withTitle,this.editDialogVisible=!0,this.dialogType=e},cancelEdit(){"add"===this.dialogType&&(this.tableData.pop(),sessionStorage.setItem("tableData",JSON.stringify(this.tableData))),this.$refs.editForm.clearValidate(),this.editDialogVisible=!1},saveEditRow(){this.$refs.editForm.validate((t=>{if(!t)return!1;this.$set(this.tableData,this.selectedIndex,this.selectedRow),this.$forceUpdate(),this.editDialogVisible=!1,sessionStorage.setItem("tableData",JSON.stringify(this.tableData))}))},initParams(){this.figure=JSON.parse(sessionStorage.getItem("figure"))||{},this.material_list=JSON.parse(sessionStorage.getItem("material_list"))||[],this.isMaterial=this.material_list.length>0,this.topOffset=Number(sessionStorage.getItem("top_offset"))||0,this.bottomOffset=Number(sessionStorage.getItem("bottom_offset"))||100,this.withSubtitle="true"===sessionStorage.getItem("with_subtitle"),this.withTitle="true"===sessionStorage.getItem("with_title"),this.reverse="true"===sessionStorage.getItem("reverse"),this.bg_volume=Number(sessionStorage.getItem("bg_volume"))||.5,this.activePresetId=sessionStorage.getItem("preset_id")||"1",this.subtitleParams.fontsize=parseInt(sessionStorage.getItem("fontsize"))||5,this.subtitleParams.color=sessionStorage.getItem("color")||"#ffffff",this.subtitleParams.font=sessionStorage.getItem("font")||"SJxingkai-C-Regular",this.subtitleParams.background_color=sessionStorage.getItem("background_color")||"rgba(64,64,64,0.6)",this.subtitleParams.stroke_color=sessionStorage.getItem("stroke_color")||"#000000",this.textStyle={backgroundColor:this.subtitleParams.background_color,color:this.subtitleParams.color,fontFamily:this.subtitleParams.font,lineHeight:1,"-webkit-text-stroke":`0.5px ${this.subtitleParams.stroke_color}`,fontSize:410*this.subtitleParams["fontsize"]/100+"px",top:this.bottomOffset+"px"},this.activeTitlePresetId=sessionStorage.getItem("title_preset_id")||"1",this.subtitleNameParams.name_fontsize=parseInt(sessionStorage.getItem("name_fontsize"))||10,this.subtitleNameParams.name_color=sessionStorage.getItem("name_color")||"#ffffff",this.subtitleNameParams.name_font=sessionStorage.getItem("name_font")||"SJxingkai-C-Regular",this.subtitleNameParams.name_background_color=sessionStorage.getItem("name_background_color")||"rgba(64,64,64,0.6)",this.subtitleNameParams.name_stroke_color=sessionStorage.getItem("name_stroke_color")||"#000000",this.titleTextStyle={backgroundColor:this.subtitleNameParams.name_background_color,color:this.subtitleNameParams.name_color,fontFamily:this.subtitleNameParams.name_font,lineHeight:1,"-webkit-text-stroke":`0.5px ${this.subtitleNameParams.name_stroke_color}`,fontSize:410*this.subtitleNameParams.name_fontsize/100+"px",top:this.topOffset+"px"},this.tableData=sessionStorage.getItem("tableData")?JSON.parse(sessionStorage.getItem("tableData")):[]},queryFontFamily(){w("/get_fonts").then((t=>{"success"===t.data.status&&(this.fontFamily=t.data.data)})).catch((t=>{console.error("获取字体样式列表失败:",t)}))},queryFigures(){w("/figure/query_success").then((t=>{if("success"===t.data.status){let e=t.data.data.filter((t=>"success"===t.status));e.length>0&&(this.materials=e.filter((t=>!t.lip_sync&&"success"===t.status)),this.figures=e.filter((t=>t.lip_sync&&"success"===t.status)))}})).catch((t=>{console.error("获取角色列表失败:",t)}))},querySounds(){w("/timbres/query_success").then((t=>{if("success"===t.data.status){if(this.voices=t.data.data.filter((t=>"success"===t.status)),this.voices.length>0){let t=JSON.parse(sessionStorage.getItem("setting_voice"));t&&this.voices.some((e=>e.id===t.id))?this.sound=t:this.sound=this.voices[0]}}else this.$message.error("获取声音列表失败。")})).catch((t=>{console.error("获取声音列表失败:",t)}))},queryBgm(){let t=[{id:"",name:"无"}];w("/bgm/all").then((e=>{if("success"===e.data.status){this.bgmList=t.concat(e.data.data);let s=JSON.parse(sessionStorage.getItem("setting_bgm"));s&&this.bgmList.some((t=>t.id===s.id))?this.bgm=s:this.bgm=this.bgmList[0]}else this.$message.error("获取背景音乐列表失败。")})).catch((t=>{console.error("获取背景音乐列表失败:",t)}))},previewAudio(t,e){""!==t.id?(this.stopAudio(),setTimeout((()=>{this.audio=new Audio(t.filepath),this.audio.play(),this.audioIndex=e,this.audio.onended=()=>{this.audio=null,this.audioIndex=null}}),100)):this.$message.warning("无音频预览")},stopAudio(){this.audio&&(this.audio.pause(),this.audio=null,this.audioIndex=null)},setName(){let t=new Date,e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0"),l=String(t.getSeconds()).padStart(2,"0"),n=e+"-"+s+"-"+i+"_"+a+"-"+o+"-"+l,r=[];for(let c=1;c<=this.tableData.length;c++)r.push(n+"_"+c);return r},verify(){w("/verify/activation").then((t=>{"success"===t.data.status?this.generateVideo():this.$alert(t.data.message,"验证失败")})).catch((t=>{console.log(t)}))},generateVideo(){if(!this.figure.video_id&&0===this.material_list.length)return void this.$alert("请先选择角色或素材","提示");if(0===this.tableData.length)return void this.$alert("请先添加口播文案","提示");if(this.withTitle&&this.tableData.some((t=>""===t.title)))return void this.$alert("开启字幕标题设置后，所有标题不能为空","提示");this.actualRequest=this.montageForm.request;let t=this.mentionList.map((t=>"@"+t.name));t.forEach(((t,e)=>{this.actualRequest=this.actualRequest.replace(t,`@{${this.material_list[e]}}`)}));let e=this.setName(),s=this.subtitleParams.background_color.replace(/rgba|\(|\)|\s/g,"").split(","),i=this.subtitleNameParams.name_background_color.replace(/rgba|\(|\)|\s/g,"").split(","),a={video_id:this.figure.video_id,material_list:this.material_list,voice_id:this.sound.voice_id,bgm_id:this.bgm.id,bg_volume:this.bg_volume,filename_list:e,user_request:this.actualRequest,reverse:this.reverse,with_text:this.with_text,with_time:this.with_time,video_num:this.video_num,text_list:this.tableData.map((t=>t.text)),with_subtitle:this.withSubtitle,with_title:this.withTitle,subtitle_params:{y_offset:this.bottomOffset,font:this.subtitleParams.font,fontsize:this.subtitleParams["fontsize"],color:this.subtitleParams.color,stroke_color:this.subtitleParams.stroke_color,use_background:0!==Number(s[3]),background_color:s.slice(0,3).map(Number),background_opacity:Number(s[3])},title_params:{y_offset:this.topOffset,title_text_list:this.tableData.map((t=>t.title)),font:this.subtitleNameParams.name_font,fontsize:this.subtitleNameParams.name_fontsize,color:this.subtitleNameParams.name_color,stroke_color:this.subtitleNameParams.name_stroke_color,use_background:0!==Number(i[3]),background_color:i.slice(0,3).map(Number),background_opacity:Number(i[3])}};C("/figure/generate_video_v2",a).then((t=>{"success"===t.data.status?(this.$alert("已创建视频生成任务，视频生成成功后会自动下载到本地","任务创建提醒"),sessionStorage.removeItem("tableData"),setTimeout((()=>{this.$router.push({path:"/videoList"})}),500)):this.$notify({title:"创建失败",message:`创建视频生成任务失败，${t.data.message}`,duration:0,type:"error"})})).catch((t=>{this.$notify({title:"创建失败",message:`创建视频生成任务失败，${t}`,duration:0,type:"error"})}))},bgmUploadSuccess(t,e){"success"===t.status?(this.$notify({title:"上传提示",message:`${e.name}背景音乐上传成功`,duration:2e4,type:"success"}),this.queryBgm()):this.$notify({title:"上传提示",message:`${e.name}背景音乐上传失败，${t.data}`,duration:0,type:"error"})},selectMaterial(t,e){if(this.isSelecting)return;const s=e.shiftKey;let i=this.materials.indexOf(t);if(!s)return this.selectResource(t),void(this.lastClickedIndex=i);if(null!==this.lastClickedIndex){const t=Math.min(this.lastClickedIndex,i),e=Math.max(this.lastClickedIndex,i);for(let s=t;s<=e;s++)this.selectResource(this.materials[s],!0)}else this.selectResource(this.materials[i]);this.lastClickedIndex=i},selectResource(t,e=!1){if(this.topOffset=0,this.bottomOffset=100,this.updateTextStyle(),this.updateTitleTextStyle(),this.isMaterial)if(this.figure={},this.material_list.includes(t.id)){if(e)return;this.material_list.splice(this.material_list.indexOf(t.id),1)}else this.material_list.push(t.id);else this.material_list=[],this.figure=this.figure.id===t.id?{}:t;console.log("1",this.material_list),console.log("2",this.mentionList),sessionStorage.setItem("figure",JSON.stringify(this.figure)),sessionStorage.setItem("material_list",JSON.stringify(this.material_list))},selectVoice(t){this.sound=t,sessionStorage.setItem("setting_voice",JSON.stringify(t))},selectBgm(t){this.bgm=t,sessionStorage.setItem("setting_bgm",JSON.stringify(t))},switchSubtitle(){sessionStorage.setItem("with_subtitle",this.withSubtitle),this.activeNames=this.withSubtitle?["1"]:[]},switchTitle(){sessionStorage.setItem("with_title",this.withTitle),this.activeTitleNames=this.withTitle?["1"]:[]},saveBgmVolume(){sessionStorage.setItem("bg_volume",this.bg_volume)},selectTitlePreset(t){this.activeTitlePresetId=t.id,sessionStorage.setItem("title_preset_id",t.id),this.subtitleNameParams.name_background_color=t.backgroundColor,sessionStorage.setItem("name_background_color",t.backgroundColor),this.subtitleNameParams.name_color=t.color,sessionStorage.setItem("name_color",t.color),this.subtitleNameParams.name_font=t.fontFamily,sessionStorage.setItem("name_font",t.fontFamily),this.subtitleNameParams.name_fontsize=10,sessionStorage.setItem("name_fontsize","10"),this.subtitleNameParams.name_stroke_color=t.stroke,sessionStorage.setItem("name_stroke_color",t.stroke),this.updateTitleTextStyle()},updateTitleTextStyle(){this.titleTextStyle={backgroundColor:this.subtitleNameParams.name_background_color,color:this.subtitleNameParams.name_color,fontFamily:this.subtitleNameParams.name_font,lineHeight:1,"-webkit-text-stroke":`0.5px ${this.subtitleNameParams.name_stroke_color}`,fontSize:410*this.subtitleNameParams.name_fontsize/100+"px",top:this.topOffset+"px"},sessionStorage.setItem("top_offset",this.topOffset)},saveSubtitleNameParams(t){let e=this.subtitleNameParams[t];this.updateTitleTextStyle(),sessionStorage.setItem(t,e),this.activeTitlePresetId="0",sessionStorage.setItem("title_preset_id","0"),this.$forceUpdate()},selectPreset(t){this.activePresetId=t.id,sessionStorage.setItem("preset_id",t.id),this.subtitleParams.background_color=t.backgroundColor,sessionStorage.setItem("background_color",t.backgroundColor),this.subtitleParams.color=t.color,sessionStorage.setItem("color",t.color),this.subtitleParams.font=t.fontFamily,sessionStorage.setItem("font",t.fontFamily),this.subtitleParams["fontsize"]=5,sessionStorage.setItem("fontsize","5"),this.subtitleParams.stroke_color=t.stroke,sessionStorage.setItem("stroke_color",t.stroke),this.updateTextStyle()},updateTextStyle(){this.textStyle={backgroundColor:this.subtitleParams.background_color,color:this.subtitleParams.color,fontFamily:this.subtitleParams.font,lineHeight:1,"-webkit-text-stroke":`0.5px ${this.subtitleParams.stroke_color}`,fontSize:410*this.subtitleParams["fontsize"]/100+"px",top:this.bottomOffset+"px"},sessionStorage.setItem("bottom_offset",this.bottomOffset)},saveSubtitleParams(t){let e=this.subtitleParams[t];this.updateTextStyle(),sessionStorage.setItem(t,e),this.activePresetId="0",sessionStorage.setItem("preset_id","0"),this.$forceUpdate()},switchReverse(){sessionStorage.setItem("reverse",this.reverse)},switchMontage(){this.montage?this.openMontageDialog():this.montageForm.request=""},openMontageDialog(){this.montageDialogVisible=!0,this.$nextTick((()=>{if(this.$refs.inputRef){const t=this.$refs.inputRef.$el.querySelector("textarea");this.replaceDivHeight=t.clientHeight,t.addEventListener("scroll",this.handleScroll)}}))},closeMontageDialog(){const t=this.$refs.inputRef.$el.querySelector("textarea");t.removeEventListener("scroll",this.handleScroll),this.montageDialogVisible=!1}}},rt=nt,ct=(0,u.A)(rt,it,at,!1,null,"ddcc48b6",null),dt=ct.exports,ut=function(){var t=this,e=t._self._c;return e("div",{staticClass:"video-list"},[e("div",{staticClass:"list-content"},[t._l(t.processList,(function(i){return e("div",{key:i.id,staticStyle:{"text-align":"center"}},[e("div",{staticClass:"image-wrapper shining"},[e("el-image",{staticStyle:{width:"180px",height:"240px","border-radius":"12px",filter:"blur(15px)",opacity:"0.8"},attrs:{src:s(4908),fit:"cover"}}),e("div",{staticClass:"shine-layer"}),e("div",{staticClass:"list-progress"},[e("div",[t._v("视频生成中")]),e("div",{staticStyle:{width:"10px","text-align":"left","margin-left":"5px","font-size":"22px"}},[t._v(t._s(t.dot))])])],1),e("div",{staticClass:"video-name",attrs:{title:i.filename}},[t._v(" "+t._s(i.filename)+" ")])])})),t._l(t.videoList,(function(s){return e("div",{key:s.id,class:{activeClass:s.id===t.selected.id},staticStyle:{"text-align":"center","border-radius":"12px",padding:"5px 0",position:"relative"},on:{contextmenu:function(e){return e.stopPropagation(),t.handleContextMenu(s,e)},click:function(e){return t.preview(s)}}},[e("el-image",{staticStyle:{width:"180px",height:"240px","border-radius":"12px"},attrs:{src:s.picture,fit:"cover"}}),e("div",{staticClass:"video-name",attrs:{title:s.filename}},[t._v(t._s(s.filename))])],1)})),t.rightMenuVisible?e("div",{style:t.menuStyle},[e("div",{staticClass:"right-item",on:{click:t.deleteVideo}},[e("i",{staticClass:"el-icon-delete-solid menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("删除")])]),e("div",{staticClass:"right-item",on:{click:t.downloadVideo}},[e("i",{staticClass:"el-icon-download menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("另存为")])]),e("div",{staticClass:"right-item",on:{click:t.rename}},[e("i",{staticClass:"el-icon-edit-outline menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("重命名")])])]):t._e(),e("el-dialog",{attrs:{visible:t.dialogVisible,"before-close":t.beforeClose,width:t.aspectRatio>1?"640px":"390px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticStyle:{width:"100%","text-align":"center",position:"relative"}},[e("video",{ref:"video",staticStyle:{"border-radius":"10px",width:"calc(100% - 40px)"},attrs:{src:t.src},on:{ended:function(e){t.isPlaying=!1},loadedmetadata:t.checkAspectRatio}}),e("div",{staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},[t.isPlaying?t._e():e("i",{staticClass:"el-icon-play control-icon",on:{click:t.controlVideo}})])])]),e("el-drawer",{attrs:{title:"重命名视频名称",visible:t.drawer,direction:"rtl"},on:{"update:visible":function(e){t.drawer=e}}},[e("div",{staticStyle:{width:"100%","text-align":"center"}},[e("el-form",{ref:"form",staticStyle:{width:"70%",margin:"0 auto"}},[e("el-form-item",{attrs:{label:"新名称",prop:"newName"}},[e("el-input",{attrs:{placeholder:"请输入新名称"},model:{value:t.newName,callback:function(e){t.newName=e},expression:"newName"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)],1)],1)])],2)])},mt=[],ht={mixins:[Y],data(){return{dotCount:1,dotTimer:null,dot:".",selected:{},drawer:!1,newName:"",videoId:"",dialogVisible:!1,src:"",aspectRatio:0,isPlaying:!1,downloadFilePath:"",downloadFileName:"",selectedId:""}},computed:{...(0,W.L8)("task",["videoTasks"]),processList(){return this.videoTasks.filter((t=>"pending"===t.status))},videoList(){return this.videoTasks.filter((t=>"success"===t.status))}},mounted(){this.startDotAnimation(),this.$store.dispatch("task/pollVideoTasks")},methods:{startDotAnimation(){this.dotTimer=setInterval((()=>{this.dotCount=this.dotCount%3+1,this.dot=".".repeat(this.dotCount)}),1e3)},deleteVideo(){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{$(`/video_record/delete/${this.selectedId}`).then((t=>{"success"===t.data.status?(this.$message.success("删除成功"),this.$store.dispatch("task/pollVideoTasks")):this.$message.error(t.data.message)}))})).catch((()=>{this.$message.info("已取消删除")}))},async downloadVideo(){let t=this;window.electronAPI.selectFolder().then((e=>{e&&(window.electronAPI.downloadFile(t.downloadFilePath,e,t.downloadFileName),t.$message.success(`视频已另存为${e}`))}))},rename(){this.videoId=this.selectedId,this.newName="",this.drawer=!0},onSave(){let t={id:this.videoId,name:this.newName};C("/video_record/update_name",t).then((t=>{"success"===t.data.status?(this.$message.success("重命名成功"),this.$store.dispatch("task/pollVideoTasks")):this.$message.error(t.data.message),this.drawer=!1})).catch((t=>{this.$message.error("重命名失败，请稍后重试！")}))},checkAspectRatio(){const t=this.$refs.video,e=t.videoWidth,s=t.videoHeight;this.aspectRatio=e/s},preview(t){this.src=t.video_path,this.dialogVisible=!0},controlVideo(){const t=this.$refs.video;this.isPlaying?(t.pause(),this.isPlaying=!1):(t.play(),this.isPlaying=!0)},beforeClose(){this.isPlaying=!1;const t=this.$refs.video;t.pause(),this.dialogVisible=!1}},beforeDestroy(){clearInterval(this.dotTimer)}},pt=ht,gt=(0,u.A)(pt,ut,mt,!1,null,"25b5f6d8",null),ft=gt.exports,vt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"system"},[e("div",{staticClass:"system-content"},[e("div",{staticClass:"title",on:{click:function(e){return t.goto("/agreement")}}},[t._v("用户协议")]),e("div",{staticClass:"title",on:{click:function(e){return t.goto("/shiftSelectAll")}}},[t._v("隐私政策")]),e("div",{staticClass:"title",on:{click:function(e){return t.goto("/videoPlayer")}}},[t._v("产品说明")]),e("div",{staticClass:"title",on:{click:t.contactUs}},[t._v("联系我们")]),e("el-form",{attrs:{inline:!0,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"保存路径"}},[e("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请选择视频下载保存路径",readonly:""},model:{value:t.downloadPath,callback:function(e){t.downloadPath=e},expression:"downloadPath"}}),e("el-button",{attrs:{icon:"el-icon-folder-opened"},on:{click:t.chooseFolder}},[t._v("选择")])],1)],1)],1),e("el-dialog",{staticClass:"contact-us-dialog",attrs:{title:"联系我们",visible:t.dialogVisible,width:"500px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"contact-us"},[e("div",{staticStyle:{"font-size":"15px","font-weight":"bold",color:"#000000",margin:"10px 0"}},[t._v("广东省奇点未来软件研发")]),e("el-image",{staticStyle:{width:"200px",height:"200px"},attrs:{src:s(8476),fit:"cover"}}),e("div",{staticStyle:{"margin-top":"20px","font-size":"14px",color:"#000000"}},[t._v("使用手机微信扫一扫，添加客服微信")])],1)])],1)},bt=[],yt={name:"system",data(){return{dialogVisible:!1,downloadPath:""}},mounted(){this.downloadPath=localStorage.getItem("downloadPath")||"D:\\offline"},methods:{contactUs(){this.dialogVisible=!0},chooseFolder(){window.electronAPI.selectFolder().then((t=>{t&&(this.downloadPath=t,localStorage.setItem("downloadPath",t))}))},goto(t){this.$router.push(t)}}},xt=yt,_t=(0,u.A)(xt,vt,bt,!1,null,"b404a152",null),St=_t.exports,kt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"agreement"},[e("i",{staticClass:"el-icon-back back",on:{click:t.goBack}}),e("div",{staticStyle:{width:"100%","text-align":"center"}},[e("el-radio-group",{model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[e("el-radio-button",{attrs:{label:"声音复刻协议"}}),e("el-radio-button",{attrs:{label:"形象克隆协议"}})],1)],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"iframe-container"},[e("iframe",{attrs:{src:t.docUrl,width:"100%",height:"100%",frameborder:"0"},on:{load:function(e){t.loading=!1}}})])])},wt=[],Ct={data(){return{type:"声音复刻协议",docFile:"",loading:!0}},computed:{docUrl(){return this.loading=!0,"声音复刻协议"===this.type?this.docFile="https://live.tellai.tech/files/timbre.docx":this.docFile="https://live.tellai.tech/files/figure.docx",`https://docs.google.com/gview?url=${encodeURIComponent(this.docFile)}&embedded=true`}},methods:{goBack(){this.$router.push("/system")}}},$t=Ct,Pt=(0,u.A)($t,kt,wt,!1,null,"421ac732",null),It=Pt.exports,Tt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"video-player-container"},[e("el-card",{staticClass:"box-card",scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"clearfix"},[e("span",[t._v("视频播放列表")]),e("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"}},[t._v(" 帮助 ")])],1)]},proxy:!0}])},[e("div",{staticClass:"video-wrapper"},[e("video",{ref:"videoRef",attrs:{controls:"",autoplay:"",preload:"metadata"},on:{ended:t.playNextVideo,timeupdate:t.updateProgress,loadedmetadata:t.updateDuration}},[t._v(" 您的浏览器不支持HTML5视频播放。 ")]),e("div",{staticClass:"video-info"},[e("el-badge",{staticClass:"item",attrs:{value:t.currentIndex+1}},[e("el-tag",{attrs:{size:"medium"}},[t._v(t._s(t.currentVideo?.name||"未选择视频"))])],1),e("div",{staticClass:"progress-container"},[e("el-slider",{staticClass:"progress-slider",attrs:{max:t.duration,"show-tooltip":"","format-tooltip":t.formatTime},on:{change:t.seek},model:{value:t.currentTime,callback:function(e){t.currentTime=e},expression:"currentTime"}})],1),e("div",{staticClass:"time-display"},[t._v(" "+t._s(t.formatTime(t.currentTime))+" / "+t._s(t.formatTime(t.duration))+" ")])],1),e("div",{staticClass:"control-bar"},[e("el-button-group",{staticClass:"btn-ground"},[e("el-button",{on:{click:t.togglePlayPause}},[e("i",{staticClass:"el-icon-video-pause",staticStyle:{"font-size":"18px"}})]),e("el-button",{on:{click:t.togglePlayPause}},[e("i",{staticClass:"el-icon-video-play",staticStyle:{"font-size":"18px"}})]),e("el-button",{on:{click:t.playPreviousVideo}},[e("i",{staticClass:"el-icon-arrow-left",staticStyle:{"font-size":"18px"}})]),e("el-button",{on:{click:t.playNextVideo}},[e("i",{staticClass:"el-icon-arrow-right",staticStyle:{"font-size":"18px"}})])],1),e("el-button-group",{staticClass:"volume-controls btn-ground"},[e("el-button",{on:{click:t.toggleMute}},[e("i",{class:0===t.volume?"el-icon-turn-off-microphone":"el-icon-microphone",staticStyle:{"font-size":"18px"}})]),e("el-slider",{staticClass:"volume-slider",attrs:{max:1,min:0,step:.1,"show-tooltip":"","format-tooltip":t.formatVolume},on:{change:t.setVolume},model:{value:t.volume,callback:function(e){t.volume=e},expression:"volume"}})],1),e("el-button-group",{staticClass:"btn-ground"},[e("el-button",{on:{click:t.toggleFullScreen}},[e("i",{staticClass:"el-icon-full-screen",staticStyle:{"font-size":"18px"}})])],1)],1)]),e("div",{staticClass:"playlist-container"},[e("el-table",{attrs:{data:t.videos,stripe:"","highlight-current-row":"","current-row-key":t.currentIndex},on:{"row-click":t.selectVideo}},[e("el-table-column",{attrs:{prop:"name",label:"视频名称"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return e.stopPropagation(),t.playVideoAtIndex(s.$index)}}},[t._v(" 播放 ")])]}}])})],1)],1)])],1)},Ft=[],Mt={data(){return{videos:[{name:"示例视频1",url:"http://127.0.0.1:8383/results/f2c35bcc-9773-40ca-b566-d5149f2e77cf-final.mp4"},{name:"示例视频2",url:"http://127.0.0.1:8383/results/f4744f29-90f0-4258-8899-6018dc3ba9bb-final.mp4"},{name:"示例视频3",url:"http://127.0.0.1:8383/results/96ba588b-800c-44e5-ae70-31821cda6db7-final.mp4"},{name:"示例视频4",url:"http://127.0.0.1:8383/results/1747b20f-ae16-445b-831d-c40e55fddd2c-r.mp4"}],currentIndex:0,currentTime:0,duration:0,isPlaying:!1,isMuted:!1,volume:.8}},computed:{currentVideo(){return this.videos[this.currentIndex]}},mounted(){this.loadVideo(this.currentIndex)},methods:{loadVideo(t){t>=0&&t<this.videos.length&&(this.currentIndex=t,this.$refs.videoRef.src=this.videos[t].url,this.$refs.videoRef.load(),this.playVideo())},playVideo(){this.$refs.videoRef.play().then((()=>{this.isPlaying=!0})).catch((t=>{console.error("播放失败:",t)}))},pauseVideo(){this.$refs.videoRef.pause(),this.isPlaying=!1},togglePlayPause(){this.isPlaying?this.pauseVideo():this.playVideo()},playNextVideo(){const t=(this.currentIndex+1)%this.videos.length;this.loadVideo(t)},playPreviousVideo(){const t=(this.currentIndex-1+this.videos.length)%this.videos.length;this.loadVideo(t)},playVideoAtIndex(t){t!==this.currentIndex&&this.loadVideo(t)},selectVideo(t,e,s){this.playVideoAtIndex(t.index)},updateProgress(){this.currentTime=this.$refs.videoRef.currentTime},seek(){this.$refs.videoRef.currentTime=this.currentTime},updateDuration(){this.duration=this.$refs.videoRef.duration},setVolume(){this.$refs.videoRef.volume=this.volume,this.isMuted=0===this.volume},toggleMute(){this.isMuted=!this.isMuted,this.$refs.videoRef.muted=this.isMuted,this.volume=this.isMuted?0:this.volume},toggleFullScreen(){const t=this.$refs.videoRef;document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},formatTime(t){const e=Math.floor(t/60),s=Math.floor(t%60);return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},formatVolume(t){return`${Math.round(100*t)}%`}}},Nt=Mt,Vt=(0,u.A)(Nt,Tt,Ft,!1,null,"b0f09162",null),Rt=Vt.exports,zt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"video-selection-container"},[e("el-checkbox",{on:{change:t.handleSelectAll},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}},[t._v("全选")]),e("div",{ref:"videoGrid",staticClass:"video-grid",on:{mousedown:t.startSelection,mousemove:t.updateSelection,mouseup:t.endSelection,mouseleave:t.endSelection}},[t._l(t.videoList,(function(s,i){return e("div",{key:s.id,ref:"videoItems",refInFor:!0,staticClass:"video-item",class:{selected:t.isSelected(i),active:t.lastClickedIndex===i},on:{click:function(e){return t.handleVideoClick(i,e)}}},[e("div",{staticClass:"video-thumbnail"},[e("img",{attrs:{src:`https://picsum.photos/seed/video${s.id}/300/200`,alt:"视频缩略图"}}),t.isSelected(i)?e("div",{staticClass:"overlay"}):t._e(),e("el-checkbox",{staticClass:"checkbox",model:{value:t.selectedIndexes[i],callback:function(e){t.$set(t.selectedIndexes,i,e)},expression:"selectedIndexes[index]"}})],1)])})),t.isSelecting?e("div",{staticClass:"selection-box",style:{left:`${t.selectionLeft}px`,top:`${t.selectionTop}px`,width:`${t.selectionWidth}px`,height:`${t.selectionHeight}px`}}):t._e()],2)],1)},At=[],Ot=(s(1148),{data(){return{videoList:[{id:1,title:"视频 1",duration:"03:45"},{id:2,title:"视频 2",duration:"05:12"},{id:3,title:"视频 3",duration:"01:30"},{id:4,title:"视频 4",duration:"02:22"},{id:5,title:"视频 5",duration:"04:15"},{id:6,title:"视频 6",duration:"02:58"},{id:7,title:"视频 7",duration:"03:10"},{id:8,title:"视频 8",duration:"01:45"},{id:9,title:"视频 9",duration:"05:30"},{id:10,title:"视频 10",duration:"02:15"}],selectedIndexes:Array(10).fill(!1),lastClickedIndex:null,selectAll:!1,isSelecting:!1,initialX:0,initialY:0,selectionLeft:0,selectionTop:0,selectionWidth:0,selectionHeight:0,initialSelectedState:[]}},methods:{isSelected(t){return this.selectedIndexes[t]},handleVideoClick(t,e){if(this.isSelecting)return void e.stopPropagation();const s=e.shiftKey;if(!s)return this.selectedIndexes[t]=!this.selectedIndexes[t],void(this.lastClickedIndex=t);if(null!==this.lastClickedIndex){const e=Math.min(this.lastClickedIndex,t),s=Math.max(this.lastClickedIndex,t);window.event.ctrlKey||window.event.metaKey||(this.selectedIndexes=Array(this.videoList.length).fill(!1));for(let t=e;t<=s;t++)this.selectedIndexes[t]=!0}else this.selectedIndexes[t]=!this.selectedIndexes[t];this.lastClickedIndex=t},handleSelectAll(t){this.selectedIndexes=Array(this.videoList.length).fill(t)},startSelection(t){if(0!==t.button||t.target.closest(".el-checkbox"))return;t.preventDefault(),t.stopPropagation();const e=this.$refs.videoGrid,s=this.$el.getBoundingClientRect();this.initialX=t.clientX-s.left,this.initialY=t.clientY-s.top-40+ +e.scrollTop,this.selectionLeft=this.initialX,this.selectionTop=this.initialY,this.selectionWidth=0,this.selectionHeight=0,this.isSelecting=!0,this.initialSelectedState=[...this.selectedIndexes]},updateSelection(t){if(!this.isSelecting)return;const e=this.$refs.videoGrid,s=this.$el.getBoundingClientRect(),i=t.clientX-s.left,a=t.clientY-s.top-40+e.scrollTop;this.selectionLeft=Math.min(this.initialX,i),this.selectionTop=Math.min(this.initialY,a),this.selectionWidth=Math.abs(i-this.initialX),this.selectionHeight=Math.abs(a-this.initialY),this.updateSelectedItems()},endSelection(){this.isSelecting&&(this.isSelecting=!1,this.selectionWidth=0,this.selectionHeight=0)},updateSelectedItems(){const t={left:this.selectionLeft,top:this.selectionTop,right:this.selectionLeft+this.selectionWidth,bottom:this.selectionTop+this.selectionHeight};this.$refs.videoItems.forEach(((e,s)=>{const i=e.getBoundingClientRect(),a=this.$el.getBoundingClientRect(),o=this.$refs.videoGrid,l={left:i.left-a.left,top:i.top-a.top-40+o.scrollTop,right:i.right-a.left,bottom:i.bottom-a.top-40+o.scrollTop},n=l.left<t.right&&l.right>t.left&&l.top<t.bottom&&l.bottom>t.top;this.selectedIndexes[s]=n||this.initialSelectedState[s]}))}},watch:{selectedIndexes:{handler(t){const e=t.every(Boolean),s=t.every((t=>!t));this.selectAll=!!e||!s&&null},deep:!0}}}),Dt=Ot,qt=(0,u.A)(Dt,zt,At,!1,null,"780492d1",null),Lt=qt.exports;i["default"].use(b.A);const Et=[{path:"/",name:"ai",component:H},{path:"/figures",name:"figures",component:G},{path:"/voice",name:"voice",component:st},{path:"/video",name:"video",component:dt},{path:"/videoList",name:"videoList",component:ft},{path:"/system",name:"system",component:St},{path:"/agreement",name:"agreement",component:It},{path:"/videoPlayer",name:"videoPlayer",component:Rt},{path:"/shiftSelectAll",name:"shiftSelectAll",component:Lt},{path:"/login",name:"Login",component:F},{path:"/register",name:"Register",component:A}],Ht=new b.A({mode:"hash",routes:Et});var Bt=Ht;const Jt={videoTasks:[],videoPreviousStatusMap:{},voiceTasks:[],voicePreviousStatusMap:{},figureTasks:[],figurePreviousStatusMap:{}},Yt={setVideoTasks(t,e){t.videoTasks=e},updatePreviousStatusMap(t,e){t.videoPreviousStatusMap={...e}},setVoiceTasks(t,e){t.voiceTasks=e},updateVoicePreviousStatusMap(t,e){t.voicePreviousStatusMap=e},setFigureTasks(t,e){t.figureTasks=e},updateFigurePreviousStatusMap(t,e){t.figurePreviousStatusMap=e}},Wt={async pollFigureTasks({state:t,commit:e}){await w("/figure/query_success").then((s=>{if("success"===s.data.status){const a=s.data.data;a.forEach((e=>{const s=t.figurePreviousStatusMap[e.id];"ready"===s&&"success"===e.status&&i["default"].prototype.$notify({title:"形象克隆成功",message:`《${e.name}》形象克隆任务已完成`,type:"success",duration:2e4}),"ready"===s&&"failed"===e.status&&i["default"].prototype.$notify({title:"形象克隆失败",message:`《${e.name}》形象克隆任务失败,${e.message}`,duration:0,type:"error"}),"pending"===s&&"success"===e.status&&i["default"].prototype.$notify({title:"素材上传成功",message:`《${e.name}》素材上传任务已完成`,type:"success",duration:2e4}),"pending"===s&&"failed"===e.status&&i["default"].prototype.$notify({title:"素材上传失败",message:`《${e.name}》素材上传任务失败,${e.message}`,duration:0,type:"error"})}));const o={};a.forEach((t=>{o[t.id]=t.status})),e("setFigureTasks",a),e("updateFigurePreviousStatusMap",o)}else this.$message.error(s.data.message)}))},async pollVoiceTasks({state:t,commit:e}){await w("/timbres/query_success").then((s=>{if("success"===s.data.status){const a=s.data.data;a.forEach((e=>{const s=t.voicePreviousStatusMap[e.id];"pending"===s&&"success"===e.status?i["default"].prototype.$notify({title:"语音合成成功",message:`《${e.name}》语音合成任务已完成`,type:"success",duration:2e4}):"pending"===s&&"failed"===e.status&&i["default"].prototype.$notify({title:"语音合成失败",message:`《${e.name}》语音合成任务失败,${e.message}`,duration:0,type:"error"})}));const o={};a.forEach((t=>{o[t.id]=t.status})),e("setVoiceTasks",a),e("updateVoicePreviousStatusMap",o)}else this.$message.error(s.data.message)}))},async pollVideoTasks({state:t,commit:e}){await w("/video_record/query").then((s=>{if("success"===s.data.status){const a=s.data.data,o={};a.forEach((t=>{o[t.id]=t.status})),a.forEach((e=>{const s=t.videoPreviousStatusMap[e.id];if("pending"===s&&"success"===e.status){i["default"].prototype.$notify({title:"视频生成成功",message:`《${e.filename}》视频生成任务已完成`,type:"success",duration:2e4});let t=localStorage.getItem("downloadPath")||"D:\\offline";window.electronAPI.downloadFile(e.video_path,t,e.filename),i["default"].prototype.$message.success(`视频已保存到${t}`)}else"pending"===s&&"failed"===e.status&&i["default"].prototype.$notify({title:"视频生成失败",message:`《${e.filename}》视频生成任务失败,${e.message}`,duration:0,type:"error"})})),e("setVideoTasks",a),e("updatePreviousStatusMap",o)}else i["default"].prototype.$message.error(s.data.message)})).catch((t=>{console.log(t)}))}},Ut={videoTasks:t=>t.videoTasks,voiceTasks:t=>t.voiceTasks,figureTasks:t=>t.figureTasks};var Xt={namespaced:!0,state:Jt,mutations:Yt,actions:Wt,getters:Ut};i["default"].use(W.Ay);const jt=new W.Ay.Store({modules:{task:Xt}});var Gt=jt,Kt=s(1052),Zt=s.n(Kt);i["default"].prototype.$store=Gt,i["default"].use(Zt()),i["default"].config.productionTip=!1,new i["default"]({router:Bt,render:t=>t(v)}).$mount("#app")},4908:function(t,e,s){t.exports=s.p+"img/4.62f0c74e.jpg"},8476:function(t,e,s){t.exports=s.p+"img/qrcode.86df65f4.png"}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var o=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=t,function(){s.amdO={}}(),function(){var t=[];s.O=function(e,i,a,o){if(!i){var l=1/0;for(d=0;d<t.length;d++){i=t[d][0],a=t[d][1],o=t[d][2];for(var n=!0,r=0;r<i.length;r++)(!1&o||l>=o)&&Object.keys(s.O).every((function(t){return s.O[t](i[r])}))?i.splice(r--,1):(n=!1,o<l&&(l=o));if(n){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[i,a,o]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){s.p=""}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,i){var a,o,l=i[0],n=i[1],r=i[2],c=0;if(l.some((function(e){return 0!==t[e]}))){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(r)var d=r(s)}for(e&&e(i);c<l.length;c++)o=l[c],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(d)},i=self["webpackChunkoffline_deployment"]=self["webpackChunkoffline_deployment"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],(function(){return s(3282)}));i=s.O(i)})();
//# sourceMappingURL=app.2f6a1ce9.js.map