(function(){"use strict";var t={857:function(t,e,s){var i=s(5471),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("dashboard")],1)},o=[],r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("el-container",[e("el-aside",{staticClass:"aside"},[e("span",{staticStyle:{"font-size":"20px","margin-bottom":"20px","font-weight":"bold",color:"#5478FE"}},[t._v("奇点")]),e("div",{staticClass:"aside-menu"},t._l(t.menus,(function(s,i){return e("div",{key:i,staticClass:"menu-group",style:{"background-color":t.active===i?"#e3eaff":"#ffffff"}},[e("div",{staticClass:"menu-item",class:{active:t.active===i,inactive:t.active!==i},attrs:{title:"克隆形象"},on:{click:function(e){return t.changeActive(i,s.path)}}},[e("i",{class:s.class,style:{color:t.active===i?"#FFFFFF":"#8F92A1","font-size":"20px"}})]),e("div",{staticStyle:{"font-size":"12px",color:"#6D7177","margin-top":"5px"}},[t._v(t._s(s.name))])])})),0)]),e("el-main",{staticClass:"main"},[e("router-view")],1)],1)],1)},n=[],l=(s(4114),s(4335)),c={components:{},data(){return{active:0,menus:[{name:"AI大模型",path:"/",class:"el-icon-robot"},{name:"克隆形象",path:"/figures",class:"el-icon-figure"},{name:"克隆声音",path:"/voice",class:"el-icon-voice"},{name:"生成视频",path:"/video",class:"el-icon-video"},{name:"视频列表",path:"/videoList",class:"el-icon-view-list"},{name:"关于我们",path:"/system",class:"el-icon-s-tools"}]}},async mounted(){this.updateActiveFromRoute()},watch:{$route(t){this.updateActiveFromRoute()}},methods:{async queryServiceStatus(){return l.A.get("http://127.0.0.1:11434/api/ps").then((t=>t.data.models.length>0)).catch((t=>!1))},async changeActive(t,e){this.active!==t&&(0===this.active&&await this.queryServiceStatus()?this.$message.error("请先关闭AI大模型服务"):(this.active=t,this.$router.push({path:e})))},updateActiveFromRoute(){for(let t=0;t<this.menus.length;t++)if(this.$route.path===this.menus[t].path){this.active=t;break}console.log("跳转后的active",this.active)}},beforeRouteUpdate(t,e,s){this.updateActiveFromRoute(),s()}},d=c,u=s(1656),h=(0,u.A)(d,r,n,!1,null,null,null),p=h.exports,m={name:"App",components:{dashboard:p},created(){}},v=m,f=(0,u.A)(v,a,o,!1,null,null,null),g=f.exports,y=s(173),w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login"},[e("div",{staticClass:"container"},[e("span",{staticStyle:{"font-size":"30px","font-weight":"bold",color:"#5478FE"}},[t._v("奇点")]),e("el-form",{ref:"form",staticClass:"login-form",attrs:{model:t.form,rules:t.rules}},[e("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[e("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),e("el-form-item",{attrs:{label:"密码",prop:"password"}},[e("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),e("el-form-item",[e("el-button",{staticClass:"btn margin-bottom-20",attrs:{type:"primary"},on:{click:t.handleLogin}},[t._v("登录")])],1),e("el-form-item",[e("el-button",{staticClass:"btn",on:{click:t.createAccount}},[t._v("创建账户")])],1)],1)],1)])},x=[];const b="http://192.168.0.122:6006",k=(t=6e4)=>l.A.create({baseURL:b,timeout:t,headers:{"Content-Type":"application/json"}});let S=k();S.interceptors.request.use((t=>t),(t=>Promise.reject(t))),S.interceptors.response.use((t=>({status:t.status,data:t.data})),(t=>(console.log(t),Promise.reject(t))));const _=(t,e={},s=6e4)=>(S=k(s),S.get(t,{params:e})),C=(t,e={},s=6e4)=>(S=k(s),S.post(t,e)),$=(t,e={},s=6e4)=>(S=k(s),S.delete(t,{params:e}));var A={data(){return{form:{phone:"",password:""},rules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"请输入正确的手机号",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符之间",trigger:"blur"}]}}},methods:{handleLogin(){C("/user/login",this.form).then((t=>{"success"===t.data.status?this.$message.success("登录成功"):this.$message.error(t.data.message)}))},createAccount(){this.$router.push({path:"/register"})}}},T=A,P=(0,u.A)(T,w,x,!1,null,"04ec44a9",null),I=P.exports,F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"register"},[e("div",{staticClass:"register-container"},[e("span",{staticStyle:{"font-size":"30px","font-weight":"bold",color:"#5478FE"}},[t._v("奇点")]),e("el-form",{ref:"form",staticClass:"login-form",attrs:{model:t.form,rules:t.rules}},[e("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[e("el-input",{model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),e("el-form-item",{attrs:{label:"密码",prop:"password"}},[e("el-input",{attrs:{type:"password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),e("el-form-item",{attrs:{label:"确认密码",prop:"rePassword"}},[e("el-input",{attrs:{type:"password"},model:{value:t.form.rePassword,callback:function(e){t.$set(t.form,"rePassword",e)},expression:"form.rePassword"}})],1),e("el-form-item",[e("el-button",{staticClass:"btn",on:{click:t.handleLogin}},[t._v("登录")])],1),e("el-form-item",[e("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.createAccount}},[t._v("创建账户")])],1)],1)],1)])},q=[],O={name:"Register",data(){return{form:{phone:"",password:"",rePassword:""},rules:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符之间",trigger:"blur"}],rePassword:[{required:!0,message:"请确认密码",trigger:["blur","change"]},{validator:this.checkConfirmPassword,trigger:["blur","change"]}]}}},methods:{handleLogin(){this.$router.push({path:"/"})},checkConfirmPassword(t,e,s){""===e?s(new Error("请确认新密码")):e!==this.form.rePassword?s(new Error("确认密码与新密码不一致")):s()},createAccount(){C("/user/register",this.form).then((t=>{"success"===t.data.status?(this.$message.success("注册成功，请登录"),this.$router.push({path:"/"})):this.$message.error(t.data.message),this.form={}}))}}},V=O,D=(0,u.A)(V,F,q,!1,null,"15625bf8",null),M=D.exports,E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ai"},[e("div",{staticClass:"ai-content"},[e("div",{staticStyle:{display:"flex",height:"40px","align-items":"center",width:"60%"}},[e("span",{staticStyle:{"margin-right":"20px","font-size":"16px",color:"#6d7177"}},[t._v("模型选择")]),e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},t._l(t.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("div",{staticStyle:{display:"flex",height:"40px","align-items":"center",width:"60%","margin-top":"40px"}},[e("span",{staticStyle:{"margin-right":"20px","font-size":"16px",color:"#6d7177"}},[t._v("模型开关")]),e("el-switch",{attrs:{width:50,"active-color":"#6286ED"},on:{change:t.switchChange},model:{value:t.modelOpen,callback:function(e){t.modelOpen=e},expression:"modelOpen"}})],1),e("el-button",{staticClass:"enter-service",on:{click:t.enterService}},[t._v("进入服务")])],1),e("div",{staticStyle:{"margin-top":"74px",color:"#6d7177","font-size":"16px","line-height":"27px"}},[t._v(" 请开启模型后再点击 “进入服务” 使用AI大模型，使用完毕后请关闭模型开关释放资源。 ")]),e("div",{staticStyle:{color:"#6d7177","font-size":"16px","line-height":"27px"}},[t._v(" 注意，模型服务与数字人形象无法同时使用，关闭模型开关即可正常使用数字人服务。 ")])])},z=[],L={data(){return{model:"deepseek-r1:32b",options:[{label:"DeepSeek R1",value:"deepseek-r1:32b"},{label:"QwQ int4",value:"qwq:latest"},{label:"QwQ int3",value:"hf-mirror.com/unsloth/QwQ-32B-GGUF:Q3_K_M"}],modelOpen:!1}},async mounted(){this.modelOpen=await this.queryServiceStatus()},methods:{enterService(){this.modelOpen?window.open("http://127.0.0.1:8080"):this.$message.error("请先开启模型服务")},async queryServiceStatus(){return l.A.get("http://127.0.0.1:11434/api/ps").then((t=>t.data.models.length>0)).catch((t=>!1))},switchChange(t){t?this.startService():this.stopService()},startService(){let t={model:this.model,keep_alive:-1};C("stop_docker_service").then((e=>{"success"===e.data.status?l.A.post("http://127.0.0.1:11434/api/generate",t).then((t=>{t.data.done?this.$message.success("模型加载成功"):this.$message.error(t.data.message)})):(this.modelOpen=!1,this.$message.error("当前后台有任务在进行中，请稍后再试。"))})).catch((t=>{this.modelOpen=!1,this.$message.error("当前后台有任务在进行中，请稍后再试。")}))},stopService(){let t={model:"hf-mirror.com/unsloth/QwQ-32B-GGUF:Q3_K_M",keep_alive:0};l.A.post("http://127.0.0.1:11434/api/generate",t).then((t=>{t.data.done?this.$message.success("模型卸载成功"):this.$message.error(t.data.message)})).catch((t=>{this.$message.error("模型卸载失败，请稍后重试。")}))}}},N=L,U=(0,u.A)(N,E,z,!1,null,"07a7afb2",null),j=U.exports,R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"figures"},[e("div",{staticClass:"figures-content"},[e("div",{staticClass:"figures-list"},[t._l(t.figureTasks,(function(i){return e("div",{key:i.id},[e("div",{staticClass:"image-wrapper shining"},[e("el-image",{staticStyle:{width:"180px",height:"236px","border-radius":"12px",filter:"blur(15px)",opacity:"0.8"},attrs:{src:s(4908),fit:"cover"}}),e("div",{staticClass:"shine-layer"})],1),e("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[e("div",[t._v("形象克隆中")]),e("div",{staticStyle:{width:"10px","text-align":"left","margin-left":"5px","font-size":"20px"}},[t._v(t._s(t.dot))])])])})),t._l(t.figures,(function(s,i){return e("div",{key:i,on:{contextmenu:function(e){return e.stopPropagation(),t.handleContextMenu(s,e)},click:function(e){return t.selectItem(s)}}},[e("el-image",{staticClass:"figures-img",attrs:{src:s.picture,fit:"cover"}}),e("div",{staticStyle:{width:"100%","text-align":"center","line-height":"23px"}},[t._v(t._s(s.name))])],1)}))],2),e("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://127.0.0.1:6006/figure/clone","show-file-list":!1,accept:".mp4, .mov","on-success":t.uploadSuccess,"on-error":t.uploadError,"before-upload":t.beforeUpload}},[e("el-button",{attrs:{type:"primary"}},[t._v("添加形象")])],1)],1),t.rightMenuVisible?e("div",{style:t.menuStyle},[e("div",{staticClass:"right-item",on:{click:t.preview}},[e("i",{staticClass:"el-icon-view menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("预览")])]),e("div",{staticClass:"right-item",on:{click:t.rename}},[e("i",{staticClass:"el-icon-edit-outline menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("重命名")])]),e("div",{staticClass:"right-item",on:{click:t.deleteItem}},[e("i",{staticClass:"el-icon-delete-solid menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("删除")])])]):t._e()]),e("el-dialog",{attrs:{visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticStyle:{width:"100%","text-align":"center",position:"relative"}},[e("video",{ref:"video",staticStyle:{width:"300px","border-radius":"20px"},attrs:{src:t.src}}),e("div",{staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},[t.isPlaying?t._e():e("i",{staticClass:"el-icon-play control-icon",on:{click:t.controlVideo}})])])]),e("el-drawer",{attrs:{title:"重命名形象名称",visible:t.drawer,direction:"rtl"},on:{"update:visible":function(e){t.drawer=e}}},[e("div",{staticStyle:{width:"100%","text-align":"center"}},[e("el-form",{ref:"form",staticStyle:{width:"70%",margin:"0 auto"}},[e("el-form-item",{attrs:{label:"新名称",prop:"newName"}},[e("el-input",{attrs:{placeholder:"请输入新名称"},model:{value:t.newName,callback:function(e){t.newName=e},expression:"newName"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)],1)],1)]),e("div",{staticClass:"figures-footer"},[t._v(" 上传的视频文件格式需为：mp4、mov、MP4、MOV格式；上传的视频文件的时长最少应不低于30秒，最长不超过600秒；上传的文件大小最大不能超过500M；上传的视频内容必须符合数字人形象训练规范，包含单个人物形象，脸部无遮挡 ")])],1)},K=[];s(8111),s(2489);const Q={data(){return{menuStyle:{position:"fixed",top:"0",left:"0",border:"1px solid #eee","border-radius":"10px","background-color":"#fff","z-index":9999},rightMenuVisible:!1,selectedItem:{}}},methods:{handleContextMenu(t,e){e.preventDefault(),this.rightMenuVisible=!0,this.selectedItem=t,this.menuStyle.left=e.clientX+"px",this.menuStyle.top=e.clientY+"px",document.body.addEventListener("click",this.bodyClick)},bodyClick(){this.rightMenuVisible=!1,this.selectedItem={},document.body.removeEventListener("click",this.bodyClick)}}};var H=s(6278),B={name:"figures",mixins:[Q],data(){return{figures:[],dialogVisible:!1,drawer:!1,src:"",isPlaying:!1,figureId:null,newName:"",dotCount:1,dotTimer:null,dot:"."}},computed:{...(0,H.L8)("task",["allTasks"]),figureTasks(){return this.allTasks.filter((t=>"figures"===t.type))}},watch:{figureTasks:{handler(){this.queryFigures()},deep:!0}},mounted(){this.queryFigures(),this.startDotAnimation()},beforeDestroy(){clearInterval(this.dotTimer)},methods:{startDotAnimation(){this.dotTimer=setInterval((()=>{this.dotCount=this.dotCount%3+1,this.dot=".".repeat(this.dotCount)}),1e3)},queryFigures(){_("/figure/query_success").then((t=>{"success"===t.data.status&&(this.figures=t.data.data)})).catch((t=>{this.$message.error("获取形象列表失败，请稍后重试！")}))},selectItem(t){this.selectedItem=t,this.preview()},preview(){this.src=this.selectedItem.filepath,this.dialogVisible=!0},rename(){this.figureId=this.selectedItem.id,this.newName="",this.drawer=!0},onSave(){let t={figure_id:this.figureId,name:this.newName};C("/figure/update_name",t).then((t=>{"success"===t.data.status?(this.$message.success("重命名成功"),this.queryFigures()):this.$message.error(t.data.message),this.drawer=!1})).catch((t=>{this.$message.error("重命名失败，请稍后重试！")}))},deleteItem(){$("/figure/delete",{figure_id:this.selectedItem.id}).then((t=>{"success"===t.data.status?(this.$message.success("删除成功"),this.queryFigures()):this.$message.error(t.data.message)})).catch((t=>{this.$message.error("删除失败，请稍后重试！")}))},controlVideo(){const t=this.$refs.video;this.isPlaying?(t.pause(),this.isPlaying=!1):(t.play(),this.isPlaying=!0)},beforeClose(){this.isPlaying=!1;const t=this.$refs.video;t.pause(),this.dialogVisible=!1},beforeUpload(t){this.task={type:"figures",id:t.uid,name:t.name,status:"running"},this.$store.dispatch("task/addTask",this.task);let e=`已创建${t.name}形象克隆任务，形象克隆成功后会自动更新形象列表`;this.$alert(e,"任务创建提醒")},uploadError(t){this.$store.dispatch("task/removeTask",t.uid),this.$notify({title:"克隆失败",message:`${t.name}形象克隆任务失败！`,duration:0,type:"error"})},uploadSuccess(t,e){"success"===t.data.status?(this.$store.dispatch("task/removeTask",e.uid),this.$notify({title:"克隆成功",message:`${e.name}形象克隆任务已完成！`,duration:0,type:"success"}),this.queryFigures()):(this.$store.dispatch("task/removeTask",e.uid),this.$notify({title:"克隆失败",message:`${e.name}形象克隆任务失败！`,duration:0,type:"error"}))}}},G=B,J=(0,u.A)(G,R,K,!1,null,"2e1a1408",null),X=J.exports,Y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"voice"},[e("div",{staticClass:"voice-content"},[e("el-row",{staticStyle:{height:"100%",width:"100%",margin:"0 auto"},attrs:{gutter:40}},[e("el-col",{staticStyle:{height:"100%"},attrs:{span:12}},[e("div",{staticClass:"voice-type"},[t._v("系统音色")]),e("div",{staticClass:"voice-list"},t._l(t.systemSounds,(function(s,i){return e("div",{key:i,staticClass:"voice-item",on:{contextmenu:function(e){return e.stopPropagation(),t.handleContextMenu(s,e)}}},[e("div",{staticClass:"voice-icon",on:{click:function(e){return t.textAudio(s)}}},[e("el-image",{staticStyle:{width:"20px",height:"20px"},attrs:{src:s.isPlay?"/stop.png":"/play.png"}})],1),e("div",{staticClass:"voice-name",attrs:{title:s.name}},[t._v(t._s(s.name))])])})),0)]),e("el-col",{staticStyle:{height:"100%"},attrs:{span:12}},[e("div",{staticClass:"voice-type"},[t._v("克隆音色")]),e("div",{staticClass:"voice-list"},[e("div",{staticClass:"voice-item"},[e("el-upload",{attrs:{action:"http://127.0.0.1:6006/timbres/clone","show-file-list":!1,accept:".mp3, .wav","on-success":t.uploadSuccess,"on-error":t.uploadError,"before-upload":t.beforeUpload}},[e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center",height:"80px"}},[e("div",{staticClass:"voice-icon",staticStyle:{"background-color":"pink !important"}},[e("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"15px",color:"red"}})]),e("div",{staticStyle:{width:"80px","margin-left":"10px","font-size":"14px",color:"#101010","text-align":"left"}},[t._v("上传音频")])])])],1),t._l(t.voiceTasks,(function(s){return e("div",{key:s.id,staticClass:"voice-item"},[e("div",{staticClass:"voice-icon",staticStyle:{"background-color":"rgba(187, 187, 187, 0.25) !important"}},[e("div",{staticClass:"dot-spinner"},t._l(8,(function(t){return e("div",{key:t,staticClass:"dot",style:{transform:"rotate("+45*t+"deg) translate(0, -9px)",animationDelay:.1*t+"s"}})})),0)]),e("div",{staticClass:"voice-name",staticStyle:{display:"flex"}},[e("div",[t._v("音色克隆中")]),e("div",{staticStyle:{width:"10px","text-align":"left","margin-left":"5px","font-size":"20px"}},[t._v(t._s(t.dot))])])])})),t._l(t.cloneSounds,(function(s,i){return e("div",{key:i,staticClass:"voice-item",on:{contextmenu:function(e){return e.stopPropagation(),t.handleContextMenu(s,e)}}},[e("div",{staticClass:"voice-icon",on:{click:function(e){return t.textAudio(s)}}},[e("el-image",{staticStyle:{width:"20px",height:"20px"},attrs:{src:s.isPlay?"/stop.png":"/play.png"}})],1),e("div",{staticClass:"voice-name",attrs:{title:s.name}},[t._v(t._s(s.name))])])}))],2)])],1),t.rightMenuVisible?e("div",{style:t.menuStyle},[e("div",{staticClass:"right-item",on:{click:t.listen}},[e("i",{staticClass:"el-icon-yangshengqi menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("试听")])]),"clone"===t.selectedItem.type?e("div",{staticClass:"right-item",on:{click:t.rename}},[e("i",{staticClass:"el-icon-edit-outline menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("重命名")])]):t._e(),"clone"===t.selectedItem.type?e("div",{staticClass:"right-item",on:{click:t.deleteItem}},[e("i",{staticClass:"el-icon-delete-solid menu-icon"}),e("span",{staticStyle:{"margin-top":"2px"}},[t._v("删除")])]):t._e()]):t._e()],1),e("el-drawer",{attrs:{title:"重命名音色名称",visible:t.drawer,direction:"rtl"},on:{"update:visible":function(e){t.drawer=e}}},[e("div",{staticStyle:{width:"100%","text-align":"center"}},[e("el-form",{ref:"form",staticStyle:{width:"70%",margin:"0 auto"}},[e("el-form-item",{attrs:{label:"新名称",prop:"newName"}},[e("el-input",{attrs:{placeholder:"请输入新名称"},model:{value:t.newName,callback:function(e){t.newName=e},expression:"newName"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSave}},[t._v("保存")])],1)],1)],1)]),e("div",{staticClass:"voice-footer"},[t._v(" 请上传格式为mp3\\wav的音频进行声音克隆，建议音频时长为3分钟。请在无遮挡场景进行录制，背景选取纯色无杂物最佳，面部表情丰富，适当添加无指向性手部动作。 ")])],1)},W=[],Z=(s(7588),{name:"Voice",mixins:[Q],data(){return{figures:[],activeSound:{},sound:{},systemSounds:[],cloneSounds:[],audio:null,newName:"",drawer:!1,soundId:null,task:{},dotCount:1,dotTimer:null,dot:"."}},computed:{...(0,H.L8)("task",["allTasks"]),voiceTasks(){return this.allTasks.filter((t=>"voice"===t.type))}},watch:{voiceTasks:{handler(){this.querySounds()},deep:!0}},mounted(){this.querySounds(),this.startDotAnimation()},beforeDestroy(){clearInterval(this.dotTimer)},methods:{startDotAnimation(){this.dotTimer=setInterval((()=>{this.dotCount=this.dotCount%3+1,this.dot=".".repeat(this.dotCount)}),1e3)},querySounds(){_("/timbres/query_success").then((t=>{"success"===t.data.status?(this.systemSounds=[],this.cloneSounds=[],t.data.data.forEach((t=>{t.isPlay=!1,"system"===t.type?this.systemSounds.push(t):this.cloneSounds.push(t)}))):this.$message.error("获取声音列表失败。")})).catch((t=>{this.$message.error("获取声音列表失败，请稍后重试！")}))},textAudio(t){this.selectedItem=t,this.listen()},listen(){let t=this.selectedItem;t.isPlay?(this.audio.pause(),this.updateStatus(t,!1)):(this.audio=new Audio(t.filepath),this.audio.play(),this.updateStatus(t,!0),this.audio.onended=()=>{this.updateStatus(t,!1)})},updateStatus(t,e){if("system"===t.type){let s=this.systemSounds.findIndex((e=>e.id===t.id));this.systemSounds[s].isPlay=e}else{let s=this.cloneSounds.findIndex((e=>e.id===t.id));this.cloneSounds[s].isPlay=e}this.$forceUpdate()},rename(){this.soundId=this.selectedItem.id,this.newName="",this.drawer=!0},onSave(){let t={timbre_id:this.soundId,name:this.newName};C("/timbres/update_name",t).then((t=>{"success"===t.data.status?(this.$message.success("重命名成功。"),this.querySounds()):this.$message.error(t.data.message),this.drawer=!1})).catch((t=>{this.$message.error("重命名失败，请稍后重试！")}))},deleteItem(){$(`/timbres/${this.selectedItem.id}`).then((t=>{"success"===t.data.status?(this.$message.success("删除成功。"),this.querySounds()):this.$message.error(t.data.message)})).catch((t=>{this.$message.error("删除失败，请稍后重试！")}))},beforeUpload(t){this.task={type:"voice",id:t.uid,name:t.name,status:"running"},this.$store.dispatch("task/addTask",this.task);let e=`已创建${t.name}音色克隆任务，音色克隆成功后会自动更新音色列表`;this.$alert(e,"任务创建提醒")},uploadError(t){this.$store.dispatch("task/removeTask",t.uid),this.$notify({title:"克隆失败",message:`${t.name}音色克隆任务失败！`,duration:0,type:"error"})},uploadSuccess(t,e){"success"===t.data.status?(this.$store.dispatch("task/removeTask",e.uid),this.$notify({title:"克隆成功",message:`${e.name}音色克隆任务已完成！`,duration:0,type:"success"}),this.querySounds()):(this.$store.dispatch("task/removeTask",e.uid),this.$notify({title:"克隆失败",message:`${e.name}音色克隆任务失败！`,duration:0,type:"error"}))}}}),tt=Z,et=(0,u.A)(tt,Y,W,!1,null,"2fa25a6b",null),st=et.exports,it=function(){var t=this,e=t._self._c;return e("div",{staticClass:"video"},[e("div",{staticClass:"video-title"},[t._v("角色选择")]),e("div",{ref:"template",staticClass:"video-template",style:t.templateStyle},t._l(t.templates,(function(s){return e("div",{key:s.id,staticStyle:{"border-radius":"10px",width:"130px"},style:{"background-color":s.id===t.figure.id?"#e0e7fb":"#FFFFFF"},on:{click:function(e){t.figure=s}}},[e("div",[e("el-image",{staticClass:"template-img",attrs:{src:s.picture,fit:"cover"}})],1),e("div",{staticClass:"template-name"},[t._v(t._s(s.name))])])})),0),e("div",{staticClass:"more-btn"},[t.templateHigh?t._e():e("i",{staticClass:"el-icon-arrow-down more",on:{click:t.showMore}}),t.templateHigh?e("i",{staticClass:"el-icon-arrow-up more",on:{click:t.showMore}}):t._e()]),e("div",{staticClass:"video-title"},[t._v("声音选择")]),e("div",{staticClass:"voice-card"},[e("div",{staticClass:"play-btn",on:{click:t.listenAudio}},[e("i",{class:t.isPlay?"el-icon-pause":"el-icon-play",staticStyle:{"font-size":"13px",color:"#6286ed"}})]),e("el-popover",{attrs:{placement:"right",trigger:"click"}},[e("div",{staticClass:"popover-content"},[e("el-row",t._l(t.voices,(function(s){return e("el-col",{key:s.id,attrs:{span:12}},[e("div",{staticClass:"voice-item",class:{active:s.id===t.sound.id},on:{click:function(e){t.sound=s}}},[e("div",{staticClass:"voice-icon",on:{click:function(e){return t.previewAudio(s)}}},[e("i",{class:s.isPlay?"el-icon-pause":"el-icon-play",staticStyle:{"font-size":"13px",color:"#6286ed"}})]),e("div",{staticClass:"voice-name"},[t._v(t._s(s.name))])])])})),1)],1),e("div",{staticClass:"sound",attrs:{slot:"reference"},slot:"reference"},[e("div",{staticClass:"sound-name"},[t._v(t._s(t.sound.name))]),e("i",{staticClass:"el-icon-a-ze-bars1",staticStyle:{"font-size":"20px",color:"#9a9a9a"}})])])],1),e("div",{staticClass:"video-title"},[t._v("口播文案")]),e("div",{staticClass:"text-card"},[e("el-input",{staticStyle:{height:"100%",width:"100%"},attrs:{type:"textarea"},on:{focus:function(e){t.isFocus=!0},blur:function(e){t.isFocus=!1}},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}),t.isFocus||""!==t.text?t._e():e("span",{staticClass:"text-tips"},[t._v("请输入视频口播文案")])],1),e("el-button",{staticClass:"generate-btn",attrs:{type:"success"},on:{click:t.generateVideo}},[t._v("生成视频")])],1)},at=[],ot={name:"Video",data(){return{isPlay:!1,templateStyle:{height:"215px",overflow:"hidden"},templateHigh:!1,templates:[],figure:{},voices:[],sound:{},text:"",audio:null,testAudio:null,isFocus:!1}},computed:{...(0,H.L8)("task",["allTasks"]),voiceAndFigureTasks(){return this.allTasks.filter((t=>"figures"===t.type||"voice"===t.type))}},watch:{voiceAndFigureTasks:{handler(){this.querySounds(),this.queryFigures()},deep:!0}},mounted(){this.querySounds(),this.queryFigures()},methods:{queryFigures(){_("/figure/query_success").then((t=>{"success"===t.data.status&&(this.templates=t.data.data,this.templates.length>0&&(this.figure=this.templates[0]))})).catch((t=>{console.error("获取角色列表失败:",t)}))},querySounds(){_("/timbres/query_success").then((t=>{"success"===t.data.status?(this.voices=t.data.data,this.voices.forEach((t=>{t.isPlay=!1})),this.voices.length>0&&(this.sound=this.voices[0])):this.$message.error("获取声音列表失败。")})).catch((t=>{console.error("获取声音列表失败:",t)}))},showMore(){this.templateHigh?(this.$refs.template.scrollTop=0,this.templateStyle.height="215px",this.templateStyle.overflow="hidden",this.templateHigh=!1):(this.templateStyle.height="430px",this.templateStyle.overflow="auto",this.templateHigh=!0)},listenAudio(){let t=this;t.isPlay?(t.isPlay=!1,t.testAudio.pause()):(t.isPlay=!0,t.testAudio=new Audio(t.sound.filepath),t.testAudio.play(),t.testAudio.onended=()=>{t.isPlay=!1})},previewAudio(t){t.isPlay?(this.audio.pause(),this.updateStatus(t,!1)):(this.audio=new Audio(t.filepath),this.audio.play(),this.updateStatus(t,!0),this.audio.onended=()=>{this.updateStatus(t,!1)})},updateStatus(t,e){let s=this.voices.findIndex((e=>e.id===t.id));this.voices[s].isPlay=e,this.$forceUpdate()},generateUniqueId(){return Date.now()+Math.random().toString(36).substr(2,16)},generateVideo(){let t={type:"video",id:this.generateUniqueId(),status:"running"};this.$store.dispatch("task/addTask",t);let e="已创建视频生成任务，视频生成成功后会自动下载到本地";this.$alert(e,"任务创建提醒"),setTimeout((()=>{this.$router.push({path:"/videoList"})}),500);let s={video_id:this.figure.video_id,voice_id:this.sound.voice_id,text:this.text};C("/figure/generate_video",s,18e6).then((e=>{if("success"===e.data.status){this.$store.dispatch("task/removeTask",t.id);let s=`${t.id}视频生成任务已完成！`;this.$notify({title:"生成成功",message:s,duration:0,type:"success"}),this.downloadVideo(e.data.data.video_path)}else{this.$store.dispatch("task/removeTask",t.id);let e=`${t.id}视频生成任务失败！`;this.$notify({title:"生成失败",message:e,duration:0,type:"error"})}})).catch((e=>{this.$store.dispatch("task/removeTask",t.id);let s=`${t.id}视频生成任务失败！`;this.$notify({title:"生成失败",message:s,duration:0,type:"error"})}))},async downloadVideo(t){let e=localStorage.getItem("downloadPath")||"D:\\Downloads";window.electronAPI.downloadFile(t,e)}}},rt=ot,nt=(0,u.A)(rt,it,at,!1,null,"42387298",null),lt=nt.exports,ct=function(){var t=this,e=t._self._c;return e("div",{staticClass:"video-list"},[e("div",{staticStyle:{flex:"1"}}),e("div",{staticClass:"list-content"},[t._l(t.videoTasks,(function(i){return e("div",{key:i.id,staticStyle:{"text-align":"center"}},[e("div",{staticClass:"image-wrapper shining"},[e("el-image",{staticStyle:{width:"180px",height:"236px","border-radius":"12px",filter:"blur(15px)",opacity:"0.8"},attrs:{src:s(4908),fit:"cover"}}),e("div",{staticClass:"shine-layer"})],1),e("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center","margin-top":"5px"}},[e("div",[t._v("视频生成中")]),e("div",{staticStyle:{width:"10px","text-align":"left","margin-left":"5px","font-size":"20px"}},[t._v(t._s(t.dot))])])])})),t._l(t.videoList,(function(s){return e("div",{key:s.id,class:{activeClass:s.id===t.selected.id},staticStyle:{"text-align":"center","border-radius":"12px",padding:"5px 0"},on:{click:function(e){return t.selectItem(s)}}},[e("el-image",{staticStyle:{width:"180px",height:"240px","border-radius":"12px"},attrs:{src:s.picture,fit:"cover"}}),e("div",{staticStyle:{"margin-top":"5px",color:"#1E1F20"}},[t._v(t._s(s.filename))])],1)}))],2),e("div",{staticStyle:{flex:"1"}},[e("el-button",{staticStyle:{width:"124px","margin-top":"40px"},attrs:{type:"danger"},on:{click:t.deleteVideo}},[t._v("删除")]),e("el-button",{staticStyle:{width:"124px","margin-top":"40px","margin-left":"50px"},attrs:{type:"primary"},on:{click:t.downloadVideo}},[t._v("下载")])],1)])},dt=[],ut={data(){return{videoList:[{id:1,picture:"",filename:"视频1"},{id:2,picture:"",filename:"视频2"},{id:3,picture:"",filename:"视频3"}],dotCount:1,dotTimer:null,dot:".",selected:{},isManage:!1}},computed:{...(0,H.L8)("task",["allTasks"]),videoTasks(){return this.allTasks.filter((t=>"video"===t.type))}},watch:{videoTasks:{handler(){this.queryVideos()},deep:!0}},mounted(){this.startDotAnimation(),this.queryVideos()},methods:{startDotAnimation(){this.dotTimer=setInterval((()=>{this.dotCount=this.dotCount%3+1,this.dot=".".repeat(this.dotCount)}),1e3)},queryVideos(){_("/video_record/query").then((t=>{"success"===t.data.status?this.videoList=t.data.data:this.$message.error(t.data.message)})).catch((t=>{console.log(t)}))},selectItem(t){this.selected=t},deleteVideo(){this.selected.id?$(`/video_record/delete/${this.selected.id}`).then((t=>{"success"===t.data.status?(this.$message.success("删除成功"),this.queryVideos(),this.isManage=!1,this.selected={}):this.$message.error(t.data.message)})):this.$message.error("请先选择要删除的视频")},async downloadVideo(){if(!this.selected.id)return void this.$message.error("请先选择要下载的视频");let t=localStorage.getItem("downloadPath")||"D:\\Downloads";window.electronAPI.downloadFile(this.selected.video_path,t),console.log(res)}},beforeDestroy(){clearInterval(this.dotTimer)}},ht=ut,pt=(0,u.A)(ht,ct,dt,!1,null,"3addfd86",null),mt=pt.exports,vt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"system"},[e("div",{staticClass:"system-content"},[e("div",{staticClass:"title",on:{click:function(e){return t.goto("/agreement")}}},[t._v("用户协议")]),e("div",{staticClass:"title"},[t._v("隐私政策")]),e("div",{staticClass:"title"},[t._v("产品说明")]),e("div",{staticClass:"title"},[t._v("联系我们")]),e("el-form",{attrs:{inline:!0,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"保存路径"}},[e("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请选择视频下载保存路径",readonly:""},model:{value:t.downloadPath,callback:function(e){t.downloadPath=e},expression:"downloadPath"}}),e("el-button",{attrs:{icon:"el-icon-folder-opened"},on:{click:t.chooseFolder}},[t._v("选择")])],1)],1)],1)])},ft=[],gt={name:"system",data(){return{downloadPath:""}},mounted(){this.downloadPath=localStorage.getItem("downloadPath")||"D:\\Downloads"},methods:{chooseFolder(){window.electronAPI.selectFolder().then((t=>{t&&(this.downloadPath=t,localStorage.setItem("downloadPath",t))}))},goto(t){this.$router.push(t)}}},yt=gt,wt=(0,u.A)(yt,vt,ft,!1,null,"ce314ce4",null),xt=wt.exports,bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"agreement"},[e("i",{staticClass:"el-icon-back back",on:{click:t.goBack}}),e("div",{staticStyle:{width:"100%","text-align":"center"}},[e("el-radio-group",{model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[e("el-radio-button",{attrs:{label:"声音复刻协议"}}),e("el-radio-button",{attrs:{label:"形象克隆协议"}})],1)],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"iframe-container"},[e("iframe",{attrs:{src:t.docUrl,width:"100%",height:"100%",frameborder:"0"},on:{load:function(e){t.loading=!1}}})])])},kt=[],St={data(){return{type:"声音复刻协议",docFile:"",loading:!0}},computed:{docUrl(){return this.loading=!0,"声音复刻协议"===this.type?this.docFile="https://live.tellai.tech/files/timbre.docx":this.docFile="https://live.tellai.tech/files/figure.docx",`https://docs.google.com/gview?url=${encodeURIComponent(this.docFile)}&embedded=true`}},methods:{goBack(){this.$router.push("/system")}}},_t=St,Ct=(0,u.A)(_t,bt,kt,!1,null,"0db94300",null),$t=Ct.exports;i["default"].use(y.A);const At=[{path:"/",name:"ai",component:j},{path:"/figures",name:"figures",component:X},{path:"/voice",name:"voice",component:st},{path:"/video",name:"video",component:lt},{path:"/videoList",name:"videoList",component:mt},{path:"/system",name:"system",component:xt},{path:"/agreement",name:"agreement",component:$t},{path:"/login",name:"Login",component:I},{path:"/register",name:"Register",component:M}],Tt=new y.A({mode:"hash",routes:At});var Pt=Tt,It=s(1052),Ft=s.n(It);const qt="task_list",Ot={tasks:[]},Vt={ADD_TASK(t,e){t.tasks.push(e),sessionStorage.setItem(qt,JSON.stringify(t.tasks))},UPDATE_TASK(t,e){const s=t.tasks.findIndex((t=>t.id===e.id));-1!==s&&(t.tasks.splice(s,1,e),sessionStorage.setItem(qt,JSON.stringify(t.tasks)))},REMOVE_TASK(t,e){t.tasks=t.tasks.filter((t=>t.id!==e)),sessionStorage.setItem(qt,JSON.stringify(t.tasks))},SET_TASKS(t,e){t.tasks=e,sessionStorage.setItem(qt,JSON.stringify(e))}},Dt={addTask({commit:t},e){t("ADD_TASK",e)},updateTask({commit:t},e){t("UPDATE_TASK",e)},removeTask({commit:t},e){t("REMOVE_TASK",e)},loadTasks({commit:t}){const e=[];t("SET_TASKS",e)}},Mt={allTasks:t=>t.tasks};var Et={namespaced:!0,state:Ot,mutations:Vt,actions:Dt,getters:Mt};i["default"].use(H.Ay);const zt=new H.Ay.Store({modules:{task:Et}});zt.dispatch("task/loadTasks");var Lt=zt;i["default"].prototype.$store=Lt,i["default"].use(Ft()),i["default"].config.productionTip=!1,new i["default"]({router:Pt,render:t=>t(g)}).$mount("#app")},4908:function(t,e,s){t.exports=s.p+"img/4.62f0c74e.jpg"}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var o=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=t,function(){s.amdO={}}(),function(){var t=[];s.O=function(e,i,a,o){if(!i){var r=1/0;for(d=0;d<t.length;d++){i=t[d][0],a=t[d][1],o=t[d][2];for(var n=!0,l=0;l<i.length;l++)(!1&o||r>=o)&&Object.keys(s.O).every((function(t){return s.O[t](i[l])}))?i.splice(l--,1):(n=!1,o<r&&(r=o));if(n){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[i,a,o]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){s.p=""}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,i){var a,o,r=i[0],n=i[1],l=i[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(l)var d=l(s)}for(e&&e(i);c<r.length;c++)o=r[c],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(d)},i=self["webpackChunkoffline_deployment"]=self["webpackChunkoffline_deployment"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],(function(){return s(857)}));i=s.O(i)})();
//# sourceMappingURL=app.1082fd17.js.map